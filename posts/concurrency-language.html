<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Guilherme Silva Blog - Concurrency language with small-step semantics</title>
        <link rel="stylesheet" href="../css/default.css" />
        <link rel="stylesheet" href="Agda.css" />
    </head>
    <body>
        <header>
            <div class="logo">
                <a href="../">Guilherme Silva</a>
            </div>
            <nav>
                <a href="../">Home</a>
                <a href="../archive.html">Archive</a>
            </nav>
        </header>

        <main role="main">
            <h1>Concurrency language with small-step semantics</h1>
            <article>
    <section class="header">
        Posted on November  3, 2021
        
            by Guilherme
        
    </section>
    <section>
        <h1 id="motivation">Motivation</h1>
<p>My motivation to formalize a concurrency programming language using small-step semantics
is to use this concept for a no deterministic programming language.</p>
<h1 id="imports">Imports</h1>
<p>Importing from <a href="https://github.com/agda/agda-stdlib">Agda standard library</a>.</p>
<pre class="Agda"><a id="364" class="Symbol">{-#</a> <a id="368" class="Keyword">OPTIONS</a> <a id="376" class="Pragma">--sized-types</a> <a id="390" class="Symbol">#-}</a>

<a id="395" class="Keyword">open</a> <a id="400" class="Keyword">import</a> <a id="407" href="Data.Bool.html" class="Module">Data.Bool</a>
<a id="417" class="Keyword">open</a> <a id="422" class="Keyword">import</a> <a id="429" href="Data.Nat.html" class="Module">Data.Nat</a>
<a id="438" class="Keyword">open</a> <a id="443" class="Keyword">import</a> <a id="450" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="488" class="Keyword">hiding</a> <a id="495" class="Symbol">(</a><a id="496" href="Relation.Binary.PropositionalEquality.html#2356" class="InductiveConstructor Operator">[_]</a><a id="499" class="Symbol">)</a>
<a id="501" class="Keyword">open</a> <a id="506" class="Keyword">import</a> <a id="513" href="Data.Product.html" class="Module">Data.Product</a>
<a id="526" class="Keyword">open</a> <a id="531" class="Keyword">import</a> <a id="538" href="Data.List.html" class="Module">Data.List</a>
<a id="548" class="Keyword">open</a> <a id="553" class="Keyword">import</a> <a id="560" href="Data.Maybe.html" class="Module">Data.Maybe</a>
<a id="571" class="Keyword">open</a> <a id="576" class="Keyword">import</a> <a id="583" href="Codata.Sized.Thunk.html" class="Module">Codata.Sized.Thunk</a>
<a id="602" class="Keyword">open</a> <a id="607" class="Keyword">import</a> <a id="614" href="Codata.Sized.Stream.html" class="Module">Codata.Sized.Stream</a> <a id="634" class="Keyword">using</a> <a id="640" class="Symbol">(</a><a id="641" href="Codata.Sized.Stream.html#912" class="Datatype">Stream</a><a id="647" class="Symbol">;</a> <a id="649" href="Codata.Sized.Stream.html#958" class="InductiveConstructor Operator">_∷_</a><a id="652" class="Symbol">;</a> <a id="654" href="Codata.Sized.Stream.html#1095" class="Function">repeat</a><a id="660" class="Symbol">)</a>
</pre>
<h1 id="defining-the-language">Defining the language</h1>
<p>The programming language is a simple command that can be a natural number,
two concurrency programs, or two programs that happen one next to the other.
In the end, the main idea is that this program just returns a list of natural numbers.</p>
<pre class="Agda"><a id="936" class="Keyword">infixr</a> <a id="943" class="Number">6</a> <a id="945" href="concurrency-language.html#1013" class="InductiveConstructor Operator">_||_</a>
<a id="950" class="Keyword">infixr</a> <a id="957" class="Number">7</a> <a id="959" href="concurrency-language.html#1050" class="InductiveConstructor Operator">_,,_</a>
<a id="964" class="Keyword">data</a> <a id="Command"></a><a id="969" href="concurrency-language.html#969" class="Datatype">Command</a> <a id="977" class="Symbol">:</a> <a id="979" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="983" class="Keyword">where</a>
  <a id="Command.print"></a><a id="991" href="concurrency-language.html#991" class="InductiveConstructor">print</a> <a id="997" class="Symbol">:</a> <a id="999" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="1001" class="Symbol">→</a> <a id="1003" href="concurrency-language.html#969" class="Datatype">Command</a>
  <a id="Command._||_"></a><a id="1013" href="concurrency-language.html#1013" class="InductiveConstructor Operator">_||_</a> <a id="1018" class="Symbol">:</a> <a id="1020" href="concurrency-language.html#969" class="Datatype">Command</a> <a id="1028" class="Symbol">→</a> <a id="1030" href="concurrency-language.html#969" class="Datatype">Command</a> <a id="1038" class="Symbol">→</a> <a id="1040" href="concurrency-language.html#969" class="Datatype">Command</a>
  <a id="Command._,,_"></a><a id="1050" href="concurrency-language.html#1050" class="InductiveConstructor Operator">_,,_</a> <a id="1055" class="Symbol">:</a> <a id="1057" href="concurrency-language.html#969" class="Datatype">Command</a> <a id="1065" class="Symbol">→</a> <a id="1067" href="concurrency-language.html#969" class="Datatype">Command</a> <a id="1075" class="Symbol">→</a> <a id="1077" href="concurrency-language.html#969" class="Datatype">Command</a>
</pre>
<h1 id="small-step">Small-Step</h1>
<p>Now, it will be defined the small-step semantic of this programming language:</p>
<pre class="Agda"><a id="NextCommand"></a><a id="1188" href="concurrency-language.html#1188" class="Function">NextCommand</a> <a id="1200" class="Symbol">=</a> <a id="1202" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="1204" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="1206" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="1212" href="concurrency-language.html#969" class="Datatype">Command</a>
</pre>
<p>The command will be reduced to a natural number that it produced or
maybe a new command if there is still a new program to reduce.</p>
<pre class="Agda"><a id="1361" class="Keyword">variable</a>
  <a id="1372" href="concurrency-language.html#1372" class="Generalizable">x</a> <a id="1374" href="concurrency-language.html#1374" class="Generalizable">m</a> <a id="1376" href="concurrency-language.html#1376" class="Generalizable">n</a> <a id="1378" class="Symbol">:</a> <a id="1380" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
  <a id="1384" href="concurrency-language.html#1384" class="Generalizable">xs</a> <a id="1387" href="concurrency-language.html#1387" class="Generalizable">ys</a> <a id="1390" class="Symbol">:</a> <a id="1392" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="1397" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
  <a id="1401" href="concurrency-language.html#1401" class="Generalizable">L</a> <a id="1403" href="concurrency-language.html#1403" class="Generalizable">M</a> <a id="1405" href="concurrency-language.html#1405" class="Generalizable">M'</a> <a id="1408" href="concurrency-language.html#1408" class="Generalizable">N</a> <a id="1410" href="concurrency-language.html#1410" class="Generalizable">N'</a> <a id="1413" class="Symbol">:</a> <a id="1415" href="concurrency-language.html#969" class="Datatype">Command</a>

<a id="1424" class="Keyword">infixr</a> <a id="1431" class="Number">2</a> <a id="1433" href="concurrency-language.html#1443" class="Datatype Operator">_—→_</a>
<a id="1438" class="Keyword">data</a> <a id="_—→_"></a><a id="1443" href="concurrency-language.html#1443" class="Datatype Operator">_—→_</a> <a id="1448" class="Symbol">:</a> <a id="1450" href="concurrency-language.html#969" class="Datatype">Command</a> <a id="1458" class="Symbol">→</a> <a id="1460" href="concurrency-language.html#1188" class="Function">NextCommand</a> <a id="1472" class="Symbol">→</a> <a id="1474" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1478" class="Keyword">where</a>
  <a id="_—→_.ξℕ"></a><a id="1486" href="concurrency-language.html#1486" class="InductiveConstructor">ξℕ</a> <a id="1489" class="Symbol">:</a> <a id="1491" href="concurrency-language.html#991" class="InductiveConstructor">print</a> <a id="1497" href="concurrency-language.html#1376" class="Generalizable">n</a> <a id="1499" href="concurrency-language.html#1443" class="Datatype Operator">—→</a> <a id="1502" href="concurrency-language.html#1376" class="Generalizable">n</a> <a id="1504" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1506" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>
</pre>
<p>The simplest reduction is when there is a simple program with just a natural number.
This program will be reduced to it and there is no program remaining.</p>
<pre class="Agda">  <a id="_—→_.ξ||ₗ"></a><a id="1681" href="concurrency-language.html#1681" class="InductiveConstructor">ξ||ₗ</a> <a id="1686" class="Symbol">:</a> <a id="1688" href="concurrency-language.html#1403" class="Generalizable">M</a> <a id="1690" href="concurrency-language.html#1443" class="Datatype Operator">—→</a> <a id="1693" href="concurrency-language.html#1374" class="Generalizable">m</a> <a id="1695" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1697" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="1702" href="concurrency-language.html#1405" class="Generalizable">M'</a>
         <a id="1714" class="Comment">------------------------------</a>
         <a id="1754" class="Symbol">→</a> <a id="1756" href="concurrency-language.html#1403" class="Generalizable">M</a> <a id="1758" href="concurrency-language.html#1013" class="InductiveConstructor Operator">||</a> <a id="1761" href="concurrency-language.html#1408" class="Generalizable">N</a> <a id="1763" href="concurrency-language.html#1443" class="Datatype Operator">—→</a> <a id="1766" href="concurrency-language.html#1374" class="Generalizable">m</a> <a id="1768" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1770" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="1775" class="Symbol">(</a><a id="1776" href="concurrency-language.html#1405" class="Generalizable">M'</a> <a id="1779" href="concurrency-language.html#1013" class="InductiveConstructor Operator">||</a> <a id="1782" href="concurrency-language.html#1408" class="Generalizable">N</a><a id="1783" class="Symbol">)</a>
</pre>
<p>If there is a parallel program, the left program will be reduced by one step.</p>
<pre class="Agda">  <a id="_—→_.ξ||∅ₗ"></a><a id="1875" href="concurrency-language.html#1875" class="InductiveConstructor">ξ||∅ₗ</a> <a id="1881" class="Symbol">:</a> <a id="1883" href="concurrency-language.html#1403" class="Generalizable">M</a> <a id="1885" href="concurrency-language.html#1443" class="Datatype Operator">—→</a> <a id="1888" href="concurrency-language.html#1374" class="Generalizable">m</a> <a id="1890" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1892" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>
          <a id="1910" class="Comment">----------------------</a>
          <a id="1943" class="Symbol">→</a> <a id="1945" href="concurrency-language.html#1403" class="Generalizable">M</a> <a id="1947" href="concurrency-language.html#1013" class="InductiveConstructor Operator">||</a> <a id="1950" href="concurrency-language.html#1408" class="Generalizable">N</a> <a id="1952" href="concurrency-language.html#1443" class="Datatype Operator">—→</a> <a id="1955" href="concurrency-language.html#1374" class="Generalizable">m</a> <a id="1957" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1959" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="1964" href="concurrency-language.html#1408" class="Generalizable">N</a>
</pre>
<p>The new program after the left ends in the parallel program is just the right program.</p>
<pre class="Agda">  <a id="_—→_.ξ||ᵣ"></a><a id="2065" href="concurrency-language.html#2065" class="InductiveConstructor">ξ||ᵣ</a> <a id="2070" class="Symbol">:</a> <a id="2072" href="concurrency-language.html#1408" class="Generalizable">N</a> <a id="2074" href="concurrency-language.html#1443" class="Datatype Operator">—→</a> <a id="2077" href="concurrency-language.html#1376" class="Generalizable">n</a> <a id="2079" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2081" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2086" href="concurrency-language.html#1410" class="Generalizable">N'</a>
         <a id="2098" class="Comment">------------------------------</a>
         <a id="2138" class="Symbol">→</a> <a id="2140" href="concurrency-language.html#1403" class="Generalizable">M</a> <a id="2142" href="concurrency-language.html#1013" class="InductiveConstructor Operator">||</a> <a id="2145" href="concurrency-language.html#1408" class="Generalizable">N</a> <a id="2147" href="concurrency-language.html#1443" class="Datatype Operator">—→</a> <a id="2150" href="concurrency-language.html#1376" class="Generalizable">n</a> <a id="2152" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2154" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2159" class="Symbol">(</a><a id="2160" href="concurrency-language.html#1403" class="Generalizable">M</a> <a id="2162" href="concurrency-language.html#1013" class="InductiveConstructor Operator">||</a> <a id="2165" href="concurrency-language.html#1410" class="Generalizable">N'</a><a id="2167" class="Symbol">)</a>
</pre>
<p>It is the same thing of a previous step but for the right program.</p>
<pre class="Agda">  <a id="_—→_.ξ||∅ᵣ"></a><a id="2248" href="concurrency-language.html#2248" class="InductiveConstructor">ξ||∅ᵣ</a> <a id="2254" class="Symbol">:</a> <a id="2256" href="concurrency-language.html#1408" class="Generalizable">N</a> <a id="2258" href="concurrency-language.html#1443" class="Datatype Operator">—→</a> <a id="2261" href="concurrency-language.html#1376" class="Generalizable">n</a> <a id="2263" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2265" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>
          <a id="2283" class="Comment">----------------------</a>
          <a id="2316" class="Symbol">→</a> <a id="2318" href="concurrency-language.html#1403" class="Generalizable">M</a> <a id="2320" href="concurrency-language.html#1013" class="InductiveConstructor Operator">||</a> <a id="2323" href="concurrency-language.html#1408" class="Generalizable">N</a> <a id="2325" href="concurrency-language.html#1443" class="Datatype Operator">—→</a> <a id="2328" href="concurrency-language.html#1376" class="Generalizable">n</a> <a id="2330" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2332" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2337" href="concurrency-language.html#1403" class="Generalizable">M</a>
</pre>
<p>It is the same thing as a previous step but for the right program.</p>
<pre class="Agda">  <a id="_—→_.ξ,,"></a><a id="2418" href="concurrency-language.html#2418" class="InductiveConstructor">ξ,,</a> <a id="2422" class="Symbol">:</a> <a id="2424" href="concurrency-language.html#1403" class="Generalizable">M</a> <a id="2426" href="concurrency-language.html#1443" class="Datatype Operator">—→</a> <a id="2429" href="concurrency-language.html#1374" class="Generalizable">m</a> <a id="2431" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2433" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2438" href="concurrency-language.html#1405" class="Generalizable">M'</a>
       <a id="2448" class="Comment">-----------------------------</a>
       <a id="2485" class="Symbol">→</a> <a id="2487" href="concurrency-language.html#1403" class="Generalizable">M</a> <a id="2489" href="concurrency-language.html#1050" class="InductiveConstructor Operator">,,</a> <a id="2492" href="concurrency-language.html#1408" class="Generalizable">N</a> <a id="2494" href="concurrency-language.html#1443" class="Datatype Operator">—→</a> <a id="2497" href="concurrency-language.html#1374" class="Generalizable">m</a> <a id="2499" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2501" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2506" class="Symbol">(</a><a id="2507" href="concurrency-language.html#1405" class="Generalizable">M'</a> <a id="2510" href="concurrency-language.html#1050" class="InductiveConstructor Operator">,,</a> <a id="2513" href="concurrency-language.html#1408" class="Generalizable">N</a><a id="2514" class="Symbol">)</a>
</pre>
<p>When there is a sequence program, the left part is reduced once and the rest of the command
is just the join of both of these programs.</p>
<pre class="Agda">  <a id="_—→_.ξ,,∅"></a><a id="2664" href="concurrency-language.html#2664" class="InductiveConstructor">ξ,,∅</a> <a id="2669" class="Symbol">:</a> <a id="2671" href="concurrency-language.html#1403" class="Generalizable">M</a> <a id="2673" href="concurrency-language.html#1443" class="Datatype Operator">—→</a> <a id="2676" href="concurrency-language.html#1374" class="Generalizable">m</a> <a id="2678" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2680" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>
       <a id="2695" class="Comment">----------------------</a>
       <a id="2725" class="Symbol">→</a> <a id="2727" href="concurrency-language.html#1403" class="Generalizable">M</a> <a id="2729" href="concurrency-language.html#1050" class="InductiveConstructor Operator">,,</a> <a id="2732" href="concurrency-language.html#1408" class="Generalizable">N</a> <a id="2734" href="concurrency-language.html#1443" class="Datatype Operator">—→</a> <a id="2737" href="concurrency-language.html#1374" class="Generalizable">m</a> <a id="2739" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2741" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2746" href="concurrency-language.html#1408" class="Generalizable">N</a>
</pre>
<p>When the left program ends, the rest of the program is the right one.</p>
<p>In this example, a parallel program can be reduced in two ways:</p>
<pre class="Agda"><a id="||prog"></a><a id="2893" href="concurrency-language.html#2893" class="Function">||prog</a> <a id="2900" class="Symbol">=</a> <a id="2902" href="concurrency-language.html#991" class="InductiveConstructor">print</a> <a id="2908" class="Number">0</a> <a id="2910" href="concurrency-language.html#1013" class="InductiveConstructor Operator">||</a> <a id="2913" href="concurrency-language.html#991" class="InductiveConstructor">print</a> <a id="2919" class="Number">1</a>

<a id="2922" href="concurrency-language.html#2922" class="Function">_</a> <a id="2924" class="Symbol">:</a> <a id="2926" href="concurrency-language.html#2893" class="Function">||prog</a> <a id="2933" href="concurrency-language.html#1443" class="Datatype Operator">—→</a> <a id="2936" class="Number">0</a> <a id="2938" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2940" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2945" class="Symbol">(</a><a id="2946" href="concurrency-language.html#991" class="InductiveConstructor">print</a> <a id="2952" class="Number">1</a><a id="2953" class="Symbol">)</a>
<a id="2955" class="Symbol">_</a> <a id="2957" class="Symbol">=</a> <a id="2959" href="concurrency-language.html#1875" class="InductiveConstructor">ξ||∅ₗ</a> <a id="2965" href="concurrency-language.html#1486" class="InductiveConstructor">ξℕ</a>

<a id="2969" href="concurrency-language.html#2969" class="Function">_</a> <a id="2971" class="Symbol">:</a> <a id="2973" href="concurrency-language.html#2893" class="Function">||prog</a> <a id="2980" href="concurrency-language.html#1443" class="Datatype Operator">—→</a> <a id="2983" class="Number">1</a> <a id="2985" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2987" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2992" class="Symbol">(</a><a id="2993" href="concurrency-language.html#991" class="InductiveConstructor">print</a> <a id="2999" class="Number">0</a><a id="3000" class="Symbol">)</a>
<a id="3002" class="Symbol">_</a> <a id="3004" class="Symbol">=</a> <a id="3006" href="concurrency-language.html#2248" class="InductiveConstructor">ξ||∅ᵣ</a> <a id="3012" href="concurrency-language.html#1486" class="InductiveConstructor">ξℕ</a>
</pre>
<h1 id="multi-step">Multi-step</h1>
<p>Now, it will be defined the multi-step of the language.
It can be a zero-step, so a command <code>M</code> can go to <code>M</code> (<code>M —↠ M</code>),
it can be multiple steps (that can be one, two, or any natural number)
or it can be a step that the command finishes.</p>
<pre class="Agda"><a id="3279" class="Keyword">infix</a>  <a id="3286" class="Number">2</a> <a id="3288" href="concurrency-language.html#3344" class="Datatype Operator">_—↠_</a>
<a id="3293" class="Keyword">infix</a>  <a id="3300" class="Number">1</a> <a id="3302" href="concurrency-language.html#3653" class="Function Operator">begin_</a>
<a id="3309" class="Keyword">infixr</a> <a id="3316" class="Number">2</a> <a id="3318" href="concurrency-language.html#3457" class="InductiveConstructor Operator">_—→⟨_⟩_</a>
<a id="3326" class="Keyword">infix</a>  <a id="3333" class="Number">3</a> <a id="3335" href="concurrency-language.html#3399" class="InductiveConstructor Operator">_∎</a>

<a id="3339" class="Keyword">data</a> <a id="_—↠_"></a><a id="3344" href="concurrency-language.html#3344" class="Datatype Operator">_—↠_</a> <a id="3349" class="Symbol">:</a> <a id="3351" href="concurrency-language.html#969" class="Datatype">Command</a> <a id="3359" class="Symbol">→</a> <a id="3361" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3366" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="3368" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="3370" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="3376" href="concurrency-language.html#969" class="Datatype">Command</a> <a id="3384" class="Symbol">→</a> <a id="3386" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="3390" class="Keyword">where</a>

  <a id="_—↠_._∎"></a><a id="3399" href="concurrency-language.html#3399" class="InductiveConstructor Operator">_∎</a> <a id="3402" class="Symbol">:</a> <a id="3404" class="Symbol">∀</a> <a id="3406" href="concurrency-language.html#3406" class="Bound">M</a>
      <a id="3414" class="Comment">----------------</a>
    <a id="3435" class="Symbol">→</a> <a id="3437" href="concurrency-language.html#3406" class="Bound">M</a> <a id="3439" href="concurrency-language.html#3344" class="Datatype Operator">—↠</a> <a id="3442" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="3445" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3447" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="3452" href="concurrency-language.html#3406" class="Bound">M</a>

  <a id="_—↠_._—→⟨_⟩_"></a><a id="3457" href="concurrency-language.html#3457" class="InductiveConstructor Operator">_—→⟨_⟩_</a> <a id="3465" class="Symbol">:</a> <a id="3467" class="Symbol">∀</a> <a id="3469" href="concurrency-language.html#3469" class="Bound">L</a> <a id="3471" class="Symbol">{</a><a id="3472" href="concurrency-language.html#3472" class="Bound">N</a><a id="3473" class="Symbol">}</a>
    <a id="3479" class="Symbol">→</a> <a id="3481" href="concurrency-language.html#3469" class="Bound">L</a> <a id="3483" href="concurrency-language.html#1443" class="Datatype Operator">—→</a> <a id="3486" href="concurrency-language.html#1372" class="Generalizable">x</a> <a id="3488" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3490" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="3495" href="concurrency-language.html#1403" class="Generalizable">M</a>
    <a id="3501" class="Symbol">→</a> <a id="3503" href="concurrency-language.html#1403" class="Generalizable">M</a> <a id="3505" href="concurrency-language.html#3344" class="Datatype Operator">—↠</a> <a id="3508" href="concurrency-language.html#1384" class="Generalizable">xs</a> <a id="3511" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3513" href="concurrency-language.html#3472" class="Bound">N</a>
      <a id="3521" class="Comment">---------------</a>
    <a id="3541" class="Symbol">→</a> <a id="3543" href="concurrency-language.html#3469" class="Bound">L</a> <a id="3545" href="concurrency-language.html#3344" class="Datatype Operator">—↠</a> <a id="3548" href="concurrency-language.html#1372" class="Generalizable">x</a> <a id="3550" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3552" href="concurrency-language.html#1384" class="Generalizable">xs</a> <a id="3555" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3557" href="concurrency-language.html#3472" class="Bound">N</a>

  <a id="_—↠_._—→⟨⟩_"></a><a id="3562" href="concurrency-language.html#3562" class="InductiveConstructor Operator">_—→⟨⟩_</a> <a id="3569" class="Symbol">:</a> <a id="3571" class="Symbol">∀</a> <a id="3573" href="concurrency-language.html#3573" class="Bound">L</a>
    <a id="3579" class="Symbol">→</a> <a id="3581" href="concurrency-language.html#3573" class="Bound">L</a> <a id="3583" href="concurrency-language.html#1443" class="Datatype Operator">—→</a> <a id="3586" href="concurrency-language.html#1372" class="Generalizable">x</a> <a id="3588" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3590" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>
      <a id="3604" class="Comment">--------------------</a>
    <a id="3629" class="Symbol">→</a> <a id="3631" href="concurrency-language.html#3573" class="Bound">L</a> <a id="3633" href="concurrency-language.html#3344" class="Datatype Operator">—↠</a> <a id="3636" href="Data.List.Base.html#5040" class="Function Operator">[</a> <a id="3638" href="concurrency-language.html#1372" class="Generalizable">x</a> <a id="3640" href="Data.List.Base.html#5040" class="Function Operator">]</a> <a id="3642" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3644" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>

<a id="begin_"></a><a id="3653" href="concurrency-language.html#3653" class="Function Operator">begin_</a> <a id="3660" class="Symbol">:</a> <a id="3662" class="Symbol">∀</a> <a id="3664" class="Symbol">{</a><a id="3665" href="concurrency-language.html#3665" class="Bound">N</a><a id="3666" class="Symbol">}</a>
  <a id="3670" class="Symbol">→</a> <a id="3672" href="concurrency-language.html#1403" class="Generalizable">M</a> <a id="3674" href="concurrency-language.html#3344" class="Datatype Operator">—↠</a> <a id="3677" href="concurrency-language.html#3665" class="Bound">N</a>
    <a id="3683" class="Comment">------</a>
  <a id="3692" class="Symbol">→</a> <a id="3694" href="concurrency-language.html#1403" class="Generalizable">M</a> <a id="3696" href="concurrency-language.html#3344" class="Datatype Operator">—↠</a> <a id="3699" href="concurrency-language.html#3665" class="Bound">N</a>
<a id="3701" href="concurrency-language.html#3653" class="Function Operator">begin</a> <a id="3707" href="concurrency-language.html#3707" class="Bound">M—↠N</a> <a id="3712" class="Symbol">=</a> <a id="3714" href="concurrency-language.html#3707" class="Bound">M—↠N</a>
</pre>
<p>When the command evaluates to nothing, it finishes:</p>
<pre class="Agda"><a id="3781" class="Keyword">infix</a> <a id="3787" class="Number">2</a> <a id="3789" href="concurrency-language.html#3794" class="Function Operator">_—⇀_</a>
<a id="_—⇀_"></a><a id="3794" href="concurrency-language.html#3794" class="Function Operator">_—⇀_</a> <a id="3799" class="Symbol">:</a> <a id="3801" href="concurrency-language.html#969" class="Datatype">Command</a> <a id="3809" class="Symbol">→</a> <a id="3811" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3816" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="3818" class="Symbol">→</a> <a id="3820" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="3824" href="concurrency-language.html#3824" class="Bound">L</a> <a id="3826" href="concurrency-language.html#3794" class="Function Operator">—⇀</a> <a id="3829" href="concurrency-language.html#3829" class="Bound">xs</a> <a id="3832" class="Symbol">=</a> <a id="3834" href="concurrency-language.html#3824" class="Bound">L</a> <a id="3836" href="concurrency-language.html#3344" class="Datatype Operator">—↠</a> <a id="3839" href="concurrency-language.html#3829" class="Bound">xs</a> <a id="3842" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3844" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>
</pre>
<p>This is a small lemma that you can concatenate the result of two sequence commands:</p>
<pre class="Agda"><a id=",,-sequence"></a><a id="3946" href="concurrency-language.html#3946" class="Function">,,-sequence</a> <a id="3958" class="Symbol">:</a>
    <a id="3964" href="concurrency-language.html#1403" class="Generalizable">M</a> <a id="3966" href="concurrency-language.html#3794" class="Function Operator">—⇀</a> <a id="3969" href="concurrency-language.html#1384" class="Generalizable">xs</a>
  <a id="3974" class="Symbol">→</a> <a id="3976" href="concurrency-language.html#1408" class="Generalizable">N</a> <a id="3978" href="concurrency-language.html#3794" class="Function Operator">—⇀</a> <a id="3981" href="concurrency-language.html#1387" class="Generalizable">ys</a>
  <a id="3986" class="Symbol">→</a> <a id="3988" href="concurrency-language.html#1403" class="Generalizable">M</a> <a id="3990" href="concurrency-language.html#1050" class="InductiveConstructor Operator">,,</a> <a id="3993" href="concurrency-language.html#1408" class="Generalizable">N</a> <a id="3995" href="concurrency-language.html#3794" class="Function Operator">—⇀</a> <a id="3998" href="concurrency-language.html#1384" class="Generalizable">xs</a> <a id="4001" href="Data.List.Base.html#1825" class="Function Operator">++</a> <a id="4004" href="concurrency-language.html#1387" class="Generalizable">ys</a>
<a id="4007" href="concurrency-language.html#3946" class="Function">,,-sequence</a> <a id="4019" class="Symbol">(_</a> <a id="4022" href="concurrency-language.html#3562" class="InductiveConstructor Operator">—→⟨⟩</a> <a id="4027" href="concurrency-language.html#4027" class="Bound">st1</a><a id="4030" class="Symbol">)</a> <a id="4032" href="concurrency-language.html#4032" class="Bound">st2</a> <a id="4036" class="Symbol">=</a> <a id="4038" class="Symbol">_</a> <a id="4040" href="concurrency-language.html#1050" class="InductiveConstructor Operator">,,</a> <a id="4043" class="Symbol">_</a> <a id="4045" href="concurrency-language.html#3457" class="InductiveConstructor Operator">—→⟨</a> <a id="4049" href="concurrency-language.html#2664" class="InductiveConstructor">ξ,,∅</a> <a id="4054" href="concurrency-language.html#4027" class="Bound">st1</a> <a id="4058" href="concurrency-language.html#3457" class="InductiveConstructor Operator">⟩</a> <a id="4060" href="concurrency-language.html#4032" class="Bound">st2</a>
<a id="4064" href="concurrency-language.html#3946" class="Function">,,-sequence</a> <a id="4076" class="Symbol">(_</a> <a id="4079" href="concurrency-language.html#3457" class="InductiveConstructor Operator">—→⟨</a> <a id="4083" href="concurrency-language.html#4083" class="Bound">st</a> <a id="4086" href="concurrency-language.html#3457" class="InductiveConstructor Operator">⟩</a> <a id="4088" href="concurrency-language.html#4088" class="Bound">st1</a><a id="4091" class="Symbol">)</a> <a id="4093" href="concurrency-language.html#4093" class="Bound">st2</a> <a id="4097" class="Symbol">=</a> <a id="4099" class="Symbol">_</a> <a id="4101" href="concurrency-language.html#1050" class="InductiveConstructor Operator">,,</a> <a id="4104" class="Symbol">_</a> <a id="4106" href="concurrency-language.html#3457" class="InductiveConstructor Operator">—→⟨</a> <a id="4110" href="concurrency-language.html#2418" class="InductiveConstructor">ξ,,</a> <a id="4114" href="concurrency-language.html#4083" class="Bound">st</a> <a id="4117" href="concurrency-language.html#3457" class="InductiveConstructor Operator">⟩</a> <a id="4119" href="concurrency-language.html#3946" class="Function">,,-sequence</a> <a id="4131" href="concurrency-language.html#4088" class="Bound">st1</a> <a id="4135" href="concurrency-language.html#4093" class="Bound">st2</a>
</pre>
<h1 id="single-step">Single-step</h1>
<p>The single-step is just the small step that you hide the result of the small step in the type.</p>
<pre class="Agda"><a id="4259" class="Keyword">data</a> <a id="SingleStep"></a><a id="4264" href="concurrency-language.html#4264" class="Datatype">SingleStep</a> <a id="4275" class="Symbol">:</a> <a id="4277" href="concurrency-language.html#969" class="Datatype">Command</a> <a id="4285" class="Symbol">→</a> <a id="4287" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="4291" class="Keyword">where</a>
  <a id="SingleStep.singleStep"></a><a id="4299" href="concurrency-language.html#4299" class="InductiveConstructor">singleStep</a> <a id="4310" class="Symbol">:</a> <a id="4312" class="Symbol">∀</a> <a id="4314" href="concurrency-language.html#4314" class="Bound">n</a> <a id="4316" href="concurrency-language.html#4316" class="Bound">L'</a>
    <a id="4323" class="Symbol">→</a> <a id="4325" href="concurrency-language.html#1401" class="Generalizable">L</a> <a id="4327" href="concurrency-language.html#1443" class="Datatype Operator">—→</a> <a id="4330" href="concurrency-language.html#4314" class="Bound">n</a> <a id="4332" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4334" href="concurrency-language.html#4316" class="Bound">L'</a>
      <a id="4343" class="Comment">----------</a>
    <a id="4358" class="Symbol">→</a> <a id="4360" href="concurrency-language.html#4264" class="Datatype">SingleStep</a> <a id="4371" href="concurrency-language.html#1401" class="Generalizable">L</a>
</pre>
<p>With the eval step, I prove that every command has a single step associated with that.
If the program is parallel, it will consume a boolean from the stream and
this boolean represents which part of the program will be evaluated.
The false represents the left part while true represents the right.</p>
<pre class="Agda"><a id="eval-step"></a><a id="4681" href="concurrency-language.html#4681" class="Function">eval-step</a> <a id="4691" class="Symbol">:</a>
  <a id="4695" href="Codata.Sized.Stream.html#912" class="Datatype">Stream</a> <a id="4702" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a> <a id="4707" class="Symbol">_</a>
  <a id="4711" class="Symbol">→</a> <a id="4713" class="Symbol">(</a><a id="4714" href="concurrency-language.html#4714" class="Bound">L</a> <a id="4716" class="Symbol">:</a> <a id="4718" href="concurrency-language.html#969" class="Datatype">Command</a><a id="4725" class="Symbol">)</a>
  <a id="4729" class="Symbol">→</a> <a id="4731" href="Codata.Sized.Stream.html#912" class="Datatype">Stream</a> <a id="4738" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a> <a id="4743" class="Symbol">_</a> <a id="4745" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="4747" href="concurrency-language.html#4264" class="Datatype">SingleStep</a> <a id="4758" href="concurrency-language.html#4714" class="Bound">L</a>
<a id="4760" href="concurrency-language.html#4681" class="Function">eval-step</a> <a id="4770" href="concurrency-language.html#4770" class="Bound">sxs</a> <a id="4774" class="Symbol">(</a><a id="4775" href="concurrency-language.html#991" class="InductiveConstructor">print</a> <a id="4781" href="concurrency-language.html#4781" class="Bound">x</a><a id="4782" class="Symbol">)</a> <a id="4784" class="Symbol">=</a> <a id="4786" href="concurrency-language.html#4770" class="Bound">sxs</a> <a id="4790" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4792" class="Symbol">(</a><a id="4793" href="concurrency-language.html#4299" class="InductiveConstructor">singleStep</a> <a id="4804" href="concurrency-language.html#4781" class="Bound">x</a> <a id="4806" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="4814" href="concurrency-language.html#1486" class="InductiveConstructor">ξℕ</a><a id="4816" class="Symbol">)</a>
<a id="4818" href="concurrency-language.html#4681" class="Function">eval-step</a> <a id="4828" href="concurrency-language.html#4828" class="Bound">sxs</a> <a id="4832" class="Symbol">(</a><a id="4833" href="concurrency-language.html#4833" class="Bound">M</a> <a id="4835" href="concurrency-language.html#1050" class="InductiveConstructor Operator">,,</a> <a id="4838" href="concurrency-language.html#4838" class="Bound">N</a><a id="4839" class="Symbol">)</a> <a id="4841" class="Keyword">with</a> <a id="4846" href="concurrency-language.html#4681" class="Function">eval-step</a> <a id="4856" href="concurrency-language.html#4828" class="Bound">sxs</a> <a id="4860" href="concurrency-language.html#4833" class="Bound">M</a>
<a id="4862" class="Symbol">...</a> <a id="4866" class="Symbol">|</a> <a id="4868" href="concurrency-language.html#4868" class="Bound">sys</a> <a id="4872" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4874" href="concurrency-language.html#4299" class="InductiveConstructor">singleStep</a> <a id="4885" href="concurrency-language.html#4885" class="Bound">n</a> <a id="4887" class="Symbol">(</a><a id="4888" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="4893" href="concurrency-language.html#4893" class="Bound">M'</a><a id="4895" class="Symbol">)</a> <a id="4897" href="concurrency-language.html#4897" class="Bound">st</a> <a id="4900" class="Symbol">=</a> <a id="4902" href="concurrency-language.html#4868" class="Bound">sys</a> <a id="4906" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4908" class="Symbol">(</a><a id="4909" href="concurrency-language.html#4299" class="InductiveConstructor">singleStep</a> <a id="4920" href="concurrency-language.html#4885" class="Bound">n</a> <a id="4922" class="Symbol">(</a><a id="4923" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="4928" class="Symbol">(</a><a id="4929" href="concurrency-language.html#4893" class="Bound">M'</a> <a id="4932" href="concurrency-language.html#1050" class="InductiveConstructor Operator">,,</a> <a id="4935" class="Bound">N</a><a id="4936" class="Symbol">))</a> <a id="4939" class="Symbol">(</a><a id="4940" href="concurrency-language.html#2418" class="InductiveConstructor">ξ,,</a> <a id="4944" href="concurrency-language.html#4897" class="Bound">st</a><a id="4946" class="Symbol">))</a>
<a id="4949" class="Symbol">...</a> <a id="4953" class="Symbol">|</a> <a id="4955" href="concurrency-language.html#4955" class="Bound">sys</a> <a id="4959" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4961" href="concurrency-language.html#4299" class="InductiveConstructor">singleStep</a> <a id="4972" href="concurrency-language.html#4972" class="Bound">n</a> <a id="4974" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="4982" href="concurrency-language.html#4982" class="Bound">st</a> <a id="4985" class="Symbol">=</a> <a id="4987" href="concurrency-language.html#4955" class="Bound">sys</a> <a id="4991" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4993" class="Symbol">(</a><a id="4994" href="concurrency-language.html#4299" class="InductiveConstructor">singleStep</a> <a id="5005" href="concurrency-language.html#4972" class="Bound">n</a> <a id="5007" class="Symbol">(</a><a id="5008" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="5013" class="Bound">N</a><a id="5014" class="Symbol">)</a> <a id="5016" class="Symbol">(</a><a id="5017" href="concurrency-language.html#2664" class="InductiveConstructor">ξ,,∅</a> <a id="5022" href="concurrency-language.html#4982" class="Bound">st</a><a id="5024" class="Symbol">))</a>
<a id="5027" href="concurrency-language.html#4681" class="Function">eval-step</a> <a id="5037" class="Symbol">(</a><a id="5038" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a> <a id="5044" href="Codata.Sized.Stream.html#958" class="InductiveConstructor Operator">∷</a> <a id="5046" href="concurrency-language.html#5046" class="Bound">sxs</a><a id="5049" class="Symbol">)</a> <a id="5051" class="Symbol">(</a><a id="5052" href="concurrency-language.html#5052" class="Bound">M</a> <a id="5054" href="concurrency-language.html#1013" class="InductiveConstructor Operator">||</a> <a id="5057" href="concurrency-language.html#5057" class="Bound">N</a><a id="5058" class="Symbol">)</a> <a id="5060" class="Keyword">with</a> <a id="5065" href="concurrency-language.html#4681" class="Function">eval-step</a> <a id="5075" class="Symbol">(</a><a id="5076" href="concurrency-language.html#5046" class="Bound">sxs</a> <a id="5080" class="Symbol">.</a><a id="5081" href="Codata.Sized.Thunk.html#547" class="Field">force</a><a id="5086" class="Symbol">)</a> <a id="5088" href="concurrency-language.html#5052" class="Bound">M</a>
<a id="5090" class="Symbol">...</a> <a id="5094" class="Symbol">|</a> <a id="5096" href="concurrency-language.html#5096" class="Bound">sys</a> <a id="5100" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5102" href="concurrency-language.html#4299" class="InductiveConstructor">singleStep</a> <a id="5113" href="concurrency-language.html#5113" class="Bound">n</a> <a id="5115" class="Symbol">(</a><a id="5116" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="5121" href="concurrency-language.html#5121" class="Bound">M'</a><a id="5123" class="Symbol">)</a> <a id="5125" href="concurrency-language.html#5125" class="Bound">st</a> <a id="5128" class="Symbol">=</a> <a id="5130" href="concurrency-language.html#5096" class="Bound">sys</a> <a id="5134" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5136" class="Symbol">(</a><a id="5137" href="concurrency-language.html#4299" class="InductiveConstructor">singleStep</a> <a id="5148" href="concurrency-language.html#5113" class="Bound">n</a> <a id="5150" class="Symbol">(</a><a id="5151" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="5156" class="Symbol">(</a><a id="5157" href="concurrency-language.html#5121" class="Bound">M'</a> <a id="5160" href="concurrency-language.html#1013" class="InductiveConstructor Operator">||</a> <a id="5163" class="Bound">N</a><a id="5164" class="Symbol">)</a> <a id="5166" class="Symbol">)</a> <a id="5168" class="Symbol">(</a><a id="5169" href="concurrency-language.html#1681" class="InductiveConstructor">ξ||ₗ</a> <a id="5174" href="concurrency-language.html#5125" class="Bound">st</a><a id="5176" class="Symbol">))</a>
<a id="5179" class="Symbol">...</a> <a id="5183" class="Symbol">|</a> <a id="5185" href="concurrency-language.html#5185" class="Bound">sys</a> <a id="5189" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5191" href="concurrency-language.html#4299" class="InductiveConstructor">singleStep</a> <a id="5202" href="concurrency-language.html#5202" class="Bound">n</a> <a id="5204" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="5212" href="concurrency-language.html#5212" class="Bound">st</a> <a id="5215" class="Symbol">=</a> <a id="5217" href="concurrency-language.html#5185" class="Bound">sys</a> <a id="5221" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5223" class="Symbol">(</a><a id="5224" href="concurrency-language.html#4299" class="InductiveConstructor">singleStep</a> <a id="5235" href="concurrency-language.html#5202" class="Bound">n</a> <a id="5237" class="Symbol">(</a><a id="5238" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="5243" class="Bound">N</a><a id="5244" class="Symbol">)</a> <a id="5246" class="Symbol">(</a><a id="5247" href="concurrency-language.html#1875" class="InductiveConstructor">ξ||∅ₗ</a> <a id="5253" href="concurrency-language.html#5212" class="Bound">st</a><a id="5255" class="Symbol">))</a>
<a id="5258" href="concurrency-language.html#4681" class="Function">eval-step</a> <a id="5268" class="Symbol">(</a><a id="5269" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a> <a id="5274" href="Codata.Sized.Stream.html#958" class="InductiveConstructor Operator">∷</a> <a id="5276" href="concurrency-language.html#5276" class="Bound">sxs</a><a id="5279" class="Symbol">)</a> <a id="5281" class="Symbol">(</a><a id="5282" href="concurrency-language.html#5282" class="Bound">M</a> <a id="5284" href="concurrency-language.html#1013" class="InductiveConstructor Operator">||</a> <a id="5287" href="concurrency-language.html#5287" class="Bound">N</a><a id="5288" class="Symbol">)</a> <a id="5290" class="Keyword">with</a> <a id="5295" href="concurrency-language.html#4681" class="Function">eval-step</a> <a id="5305" class="Symbol">(</a><a id="5306" href="concurrency-language.html#5276" class="Bound">sxs</a> <a id="5310" class="Symbol">.</a><a id="5311" href="Codata.Sized.Thunk.html#547" class="Field">force</a><a id="5316" class="Symbol">)</a> <a id="5318" href="concurrency-language.html#5287" class="Bound">N</a>
<a id="5320" class="Symbol">...</a> <a id="5324" class="Symbol">|</a> <a id="5326" href="concurrency-language.html#5326" class="Bound">sys</a> <a id="5330" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5332" href="concurrency-language.html#4299" class="InductiveConstructor">singleStep</a> <a id="5343" href="concurrency-language.html#5343" class="Bound">n</a> <a id="5345" class="Symbol">(</a><a id="5346" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="5351" href="concurrency-language.html#5351" class="Bound">N'</a><a id="5353" class="Symbol">)</a> <a id="5355" href="concurrency-language.html#5355" class="Bound">st</a> <a id="5358" class="Symbol">=</a> <a id="5360" href="concurrency-language.html#5326" class="Bound">sys</a> <a id="5364" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5366" class="Symbol">(</a><a id="5367" href="concurrency-language.html#4299" class="InductiveConstructor">singleStep</a> <a id="5378" href="concurrency-language.html#5343" class="Bound">n</a> <a id="5380" class="Symbol">(</a><a id="5381" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="5386" class="Symbol">(</a><a id="5387" class="Bound">M</a> <a id="5389" href="concurrency-language.html#1013" class="InductiveConstructor Operator">||</a> <a id="5392" href="concurrency-language.html#5351" class="Bound">N'</a><a id="5394" class="Symbol">)</a> <a id="5396" class="Symbol">)</a> <a id="5398" class="Symbol">(</a><a id="5399" href="concurrency-language.html#2065" class="InductiveConstructor">ξ||ᵣ</a> <a id="5404" href="concurrency-language.html#5355" class="Bound">st</a><a id="5406" class="Symbol">))</a>
<a id="5409" class="Symbol">...</a> <a id="5413" class="Symbol">|</a> <a id="5415" href="concurrency-language.html#5415" class="Bound">sys</a> <a id="5419" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5421" href="concurrency-language.html#4299" class="InductiveConstructor">singleStep</a> <a id="5432" href="concurrency-language.html#5432" class="Bound">n</a> <a id="5434" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="5442" href="concurrency-language.html#5442" class="Bound">st</a> <a id="5445" class="Symbol">=</a> <a id="5447" href="concurrency-language.html#5415" class="Bound">sys</a> <a id="5451" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5453" class="Symbol">(</a><a id="5454" href="concurrency-language.html#4299" class="InductiveConstructor">singleStep</a> <a id="5465" href="concurrency-language.html#5432" class="Bound">n</a> <a id="5467" class="Symbol">(</a><a id="5468" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="5473" class="Bound">M</a><a id="5474" class="Symbol">)</a> <a id="5476" class="Symbol">(</a><a id="5477" href="concurrency-language.html#2248" class="InductiveConstructor">ξ||∅ᵣ</a> <a id="5483" href="concurrency-language.html#5442" class="Bound">st</a><a id="5485" class="Symbol">))</a>
</pre>
<h1 id="evaluation">Evaluation</h1>
<p>For the definition of evaluation, it will necessary to be defined when an
command was finished in the evaluation and the steps of the evaluation.</p>
<pre class="Agda"><a id="5658" class="Keyword">data</a> <a id="Steps"></a><a id="5663" href="concurrency-language.html#5663" class="Datatype">Steps</a> <a id="5669" class="Symbol">:</a> <a id="5671" href="concurrency-language.html#969" class="Datatype">Command</a> <a id="5679" class="Symbol">→</a> <a id="5681" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="5685" class="Keyword">where</a>
  <a id="Steps.steps"></a><a id="5693" href="concurrency-language.html#5693" class="InductiveConstructor">steps</a> <a id="5699" class="Symbol">:</a> <a id="5701" class="Symbol">∀</a> <a id="5703" href="concurrency-language.html#5703" class="Bound">xs</a>
    <a id="5710" class="Symbol">→</a> <a id="5712" href="concurrency-language.html#1401" class="Generalizable">L</a> <a id="5714" href="concurrency-language.html#3794" class="Function Operator">—⇀</a> <a id="5717" href="concurrency-language.html#5703" class="Bound">xs</a>
      <a id="5726" class="Comment">----------</a>
    <a id="5741" class="Symbol">→</a> <a id="5743" href="concurrency-language.html#5663" class="Datatype">Steps</a> <a id="5749" href="concurrency-language.html#1401" class="Generalizable">L</a>

<a id="5752" class="Keyword">data</a> <a id="Finished"></a><a id="5757" href="concurrency-language.html#5757" class="Datatype">Finished</a> <a id="5766" class="Symbol">(</a><a id="5767" href="concurrency-language.html#5767" class="Bound">N</a> <a id="5769" class="Symbol">:</a> <a id="5771" href="concurrency-language.html#969" class="Datatype">Command</a><a id="5778" class="Symbol">)</a> <a id="5780" class="Symbol">:</a> <a id="5782" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="5786" class="Keyword">where</a>
   <a id="Finished.done"></a><a id="5795" href="concurrency-language.html#5795" class="InductiveConstructor">done</a> <a id="5800" class="Symbol">:</a>
       <a id="5809" href="concurrency-language.html#5663" class="Datatype">Steps</a> <a id="5815" href="concurrency-language.html#5767" class="Bound">N</a>
       <a id="5824" class="Comment">----------</a>
     <a id="5840" class="Symbol">→</a> <a id="5842" href="concurrency-language.html#5757" class="Datatype">Finished</a> <a id="5851" href="concurrency-language.html#5767" class="Bound">N</a>

   <a id="Finished.out-of-gas"></a><a id="5857" href="concurrency-language.html#5857" class="InductiveConstructor">out-of-gas</a> <a id="5868" class="Symbol">:</a>
       <a id="5877" class="Comment">----------</a>
       <a id="5895" href="concurrency-language.html#5757" class="Datatype">Finished</a> <a id="5904" href="concurrency-language.html#5767" class="Bound">N</a>
</pre>
<p>A command is finished when it is a value or when there is no more gas
available to calculate it.
In Agda, every computation must terminate. So it is impossible to have
an infinite loop. So when a command takes so much time
to finish, it runs out of gas and there is no result.</p>
<p>The evaluation finishes when there is proof of multi-step for the value
and it is already finished.</p>
<pre class="Agda"><a id="eval"></a><a id="6294" href="concurrency-language.html#6294" class="Function">eval</a> <a id="6299" class="Symbol">:</a>
  <a id="6303" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
  <a id="6307" class="Symbol">→</a> <a id="6309" href="Codata.Sized.Stream.html#912" class="Datatype">Stream</a> <a id="6316" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a> <a id="6321" class="Symbol">_</a>
  <a id="6325" class="Symbol">→</a> <a id="6327" class="Symbol">(</a><a id="6328" href="concurrency-language.html#6328" class="Bound">L</a> <a id="6330" class="Symbol">:</a> <a id="6332" href="concurrency-language.html#969" class="Datatype">Command</a><a id="6339" class="Symbol">)</a>
  <a id="6343" class="Symbol">→</a> <a id="6345" href="concurrency-language.html#5757" class="Datatype">Finished</a> <a id="6354" href="concurrency-language.html#6328" class="Bound">L</a>
<a id="6356" href="concurrency-language.html#6294" class="Function">eval</a> <a id="6361" class="Number">0</a> <a id="6363" href="concurrency-language.html#6363" class="Bound">sxs</a> <a id="6367" href="concurrency-language.html#6367" class="Bound">L</a> <a id="6369" class="Symbol">=</a> <a id="6371" href="concurrency-language.html#5857" class="InductiveConstructor">out-of-gas</a>
<a id="6382" href="concurrency-language.html#6294" class="Function">eval</a> <a id="6387" class="Symbol">(</a><a id="6388" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="6392" href="concurrency-language.html#6392" class="Bound">gas</a><a id="6395" class="Symbol">)</a> <a id="6397" href="concurrency-language.html#6397" class="Bound">sxs</a> <a id="6401" href="concurrency-language.html#6401" class="Bound">L</a> <a id="6403" class="Keyword">with</a> <a id="6408" href="concurrency-language.html#4681" class="Function">eval-step</a> <a id="6418" href="concurrency-language.html#6397" class="Bound">sxs</a> <a id="6422" href="concurrency-language.html#6401" class="Bound">L</a>
<a id="6424" class="Symbol">...</a> <a id="6428" class="Symbol">|</a> <a id="6430" href="concurrency-language.html#6430" class="Bound">sys</a> <a id="6434" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="6436" href="concurrency-language.html#4299" class="InductiveConstructor">singleStep</a> <a id="6447" href="concurrency-language.html#6447" class="Bound">n</a> <a id="6449" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="6457" href="concurrency-language.html#6457" class="Bound">st</a> <a id="6460" class="Symbol">=</a> <a id="6462" href="concurrency-language.html#5795" class="InductiveConstructor">done</a> <a id="6467" class="Symbol">(</a><a id="6468" href="concurrency-language.html#5693" class="InductiveConstructor">steps</a> <a id="6474" href="Data.List.Base.html#5040" class="Function Operator">[</a> <a id="6476" href="concurrency-language.html#6447" class="Bound">n</a> <a id="6478" href="Data.List.Base.html#5040" class="Function Operator">]</a> <a id="6480" class="Symbol">(</a><a id="6481" class="Bound">L</a> <a id="6483" href="concurrency-language.html#3562" class="InductiveConstructor Operator">—→⟨⟩</a> <a id="6488" href="concurrency-language.html#6457" class="Bound">st</a><a id="6490" class="Symbol">))</a>
<a id="6493" class="Symbol">...</a> <a id="6497" class="Symbol">|</a> <a id="6499" href="concurrency-language.html#6499" class="Bound">sys</a> <a id="6503" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="6505" href="concurrency-language.html#4299" class="InductiveConstructor">singleStep</a> <a id="6516" href="concurrency-language.html#6516" class="Bound">n</a> <a id="6518" class="Symbol">(</a><a id="6519" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="6524" href="concurrency-language.html#6524" class="Bound">M</a><a id="6525" class="Symbol">)</a> <a id="6527" href="concurrency-language.html#6527" class="Bound">st</a> <a id="6530" class="Keyword">with</a> <a id="6535" href="concurrency-language.html#6294" class="Function">eval</a> <a id="6540" class="Bound">gas</a> <a id="6544" href="concurrency-language.html#6499" class="Bound">sys</a> <a id="6548" href="concurrency-language.html#6524" class="Bound">M</a>
<a id="6550" class="Symbol">...</a>   <a id="6556" class="Symbol">|</a> <a id="6558" href="concurrency-language.html#5857" class="InductiveConstructor">out-of-gas</a> <a id="6569" class="Symbol">=</a> <a id="6571" href="concurrency-language.html#5857" class="InductiveConstructor">out-of-gas</a>
<a id="6582" class="Symbol">...</a>   <a id="6588" class="Symbol">|</a> <a id="6590" href="concurrency-language.html#5795" class="InductiveConstructor">done</a> <a id="6595" class="Symbol">(</a><a id="6596" href="concurrency-language.html#5693" class="InductiveConstructor">steps</a> <a id="6602" href="concurrency-language.html#6602" class="Bound">xs</a> <a id="6605" href="concurrency-language.html#6605" class="Bound">st2</a><a id="6608" class="Symbol">)</a> <a id="6610" class="Symbol">=</a> <a id="6612" href="concurrency-language.html#5795" class="InductiveConstructor">done</a> <a id="6617" class="Symbol">(</a><a id="6618" href="concurrency-language.html#5693" class="InductiveConstructor">steps</a> <a id="6624" class="Symbol">(</a><a id="6625" class="Bound">n</a> <a id="6627" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="6629" href="concurrency-language.html#6602" class="Bound">xs</a><a id="6631" class="Symbol">)</a> <a id="6633" class="Symbol">(</a><a id="6634" class="Bound">L</a> <a id="6636" href="concurrency-language.html#3457" class="InductiveConstructor Operator">—→⟨</a> <a id="6640" class="Bound">st</a> <a id="6643" href="concurrency-language.html#3457" class="InductiveConstructor Operator">⟩</a> <a id="6645" href="concurrency-language.html#6605" class="Bound">st2</a><a id="6648" class="Symbol">))</a>
</pre>
<p>The evaluation takes gas and the command to evaluate.
In the end, it returns the value with proof that the command evaluates
this value.</p>
<p>Here, some examples of the evaluation:</p>
<pre class="Agda"><a id="rfalse"></a><a id="6838" href="concurrency-language.html#6838" class="Function">rfalse</a> <a id="6845" class="Symbol">=</a> <a id="6847" href="Codata.Sized.Stream.html#1095" class="Function">repeat</a> <a id="6854" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a>
<a id="rtrue"></a><a id="6860" href="concurrency-language.html#6860" class="Function">rtrue</a> <a id="6866" class="Symbol">=</a> <a id="6868" href="Codata.Sized.Stream.html#1095" class="Function">repeat</a> <a id="6875" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a>
<a id="evalf"></a><a id="6880" href="concurrency-language.html#6880" class="Function">evalf</a> <a id="6886" class="Symbol">=</a> <a id="6888" href="concurrency-language.html#6294" class="Function">eval</a> <a id="6893" class="Number">100</a> <a id="6897" href="concurrency-language.html#6838" class="Function">rfalse</a>
<a id="evalt"></a><a id="6904" href="concurrency-language.html#6904" class="Function">evalt</a> <a id="6910" class="Symbol">=</a> <a id="6912" href="concurrency-language.html#6294" class="Function">eval</a> <a id="6917" class="Number">100</a> <a id="6921" href="concurrency-language.html#6860" class="Function">rtrue</a>

<a id="6928" href="concurrency-language.html#6928" class="Function">_</a> <a id="6930" class="Symbol">:</a> <a id="6932" href="concurrency-language.html#6880" class="Function">evalf</a> <a id="6938" href="concurrency-language.html#2893" class="Function">||prog</a> <a id="6945" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="6947" href="concurrency-language.html#5795" class="InductiveConstructor">done</a>
  <a id="6954" class="Symbol">(</a><a id="6955" href="concurrency-language.html#5693" class="InductiveConstructor">steps</a> <a id="6961" class="Symbol">(</a><a id="6962" class="Number">0</a> <a id="6964" class="InductiveConstructor Operator">∷</a> <a id="6966" href="Data.List.Base.html#5040" class="Function Operator">[</a> <a id="6968" class="Number">1</a> <a id="6970" href="Data.List.Base.html#5040" class="Function Operator">]</a><a id="6971" class="Symbol">)</a>
  <a id="6975" class="Symbol">(</a><a id="6976" href="concurrency-language.html#991" class="InductiveConstructor">print</a> <a id="6982" class="Number">0</a> <a id="6984" href="concurrency-language.html#1013" class="InductiveConstructor Operator">||</a> <a id="6987" href="concurrency-language.html#991" class="InductiveConstructor">print</a> <a id="6993" class="Number">1</a> <a id="6995" href="concurrency-language.html#3457" class="InductiveConstructor Operator">—→⟨</a> <a id="6999" href="concurrency-language.html#1875" class="InductiveConstructor">ξ||∅ₗ</a> <a id="7005" href="concurrency-language.html#1486" class="InductiveConstructor">ξℕ</a> <a id="7008" href="concurrency-language.html#3457" class="InductiveConstructor Operator">⟩</a>
  <a id="7012" class="Symbol">(</a><a id="7013" href="concurrency-language.html#991" class="InductiveConstructor">print</a> <a id="7019" class="Number">1</a> <a id="7021" href="concurrency-language.html#3562" class="InductiveConstructor Operator">—→⟨⟩</a> <a id="7026" href="concurrency-language.html#1486" class="InductiveConstructor">ξℕ</a><a id="7028" class="Symbol">)))</a>
<a id="7032" class="Symbol">_</a> <a id="7034" class="Symbol">=</a> <a id="7036" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>

<a id="7042" href="concurrency-language.html#7042" class="Function">_</a> <a id="7044" class="Symbol">:</a> <a id="7046" href="concurrency-language.html#6904" class="Function">evalt</a> <a id="7052" href="concurrency-language.html#2893" class="Function">||prog</a> <a id="7059" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="7061" href="concurrency-language.html#5795" class="InductiveConstructor">done</a>
  <a id="7068" class="Symbol">(</a><a id="7069" href="concurrency-language.html#5693" class="InductiveConstructor">steps</a> <a id="7075" class="Symbol">(</a><a id="7076" class="Number">1</a> <a id="7078" class="InductiveConstructor Operator">∷</a> <a id="7080" href="Data.List.Base.html#5040" class="Function Operator">[</a> <a id="7082" class="Number">0</a> <a id="7084" href="Data.List.Base.html#5040" class="Function Operator">]</a><a id="7085" class="Symbol">)</a>
  <a id="7089" class="Symbol">(</a><a id="7090" href="concurrency-language.html#991" class="InductiveConstructor">print</a> <a id="7096" class="Number">0</a> <a id="7098" href="concurrency-language.html#1013" class="InductiveConstructor Operator">||</a> <a id="7101" href="concurrency-language.html#991" class="InductiveConstructor">print</a> <a id="7107" class="Number">1</a> <a id="7109" href="concurrency-language.html#3457" class="InductiveConstructor Operator">—→⟨</a> <a id="7113" href="concurrency-language.html#2248" class="InductiveConstructor">ξ||∅ᵣ</a> <a id="7119" href="concurrency-language.html#1486" class="InductiveConstructor">ξℕ</a> <a id="7122" href="concurrency-language.html#3457" class="InductiveConstructor Operator">⟩</a>
  <a id="7126" class="Symbol">(</a><a id="7127" href="concurrency-language.html#991" class="InductiveConstructor">print</a> <a id="7133" class="Number">0</a> <a id="7135" href="concurrency-language.html#3562" class="InductiveConstructor Operator">—→⟨⟩</a> <a id="7140" href="concurrency-language.html#1486" class="InductiveConstructor">ξℕ</a><a id="7142" class="Symbol">)))</a>
<a id="7146" class="Symbol">_</a> <a id="7148" class="Symbol">=</a> <a id="7150" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>

<a id="7156" href="concurrency-language.html#7156" class="Function">_</a> <a id="7158" class="Symbol">:</a> <a id="7160" href="concurrency-language.html#6880" class="Function">evalf</a> <a id="7166" class="Symbol">(</a><a id="7167" href="concurrency-language.html#991" class="InductiveConstructor">print</a> <a id="7173" class="Number">0</a> <a id="7175" href="concurrency-language.html#1050" class="InductiveConstructor Operator">,,</a> <a id="7178" href="concurrency-language.html#991" class="InductiveConstructor">print</a> <a id="7184" class="Number">1</a><a id="7185" class="Symbol">)</a> <a id="7187" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="7189" href="concurrency-language.html#5795" class="InductiveConstructor">done</a>
  <a id="7196" class="Symbol">(</a><a id="7197" href="concurrency-language.html#5693" class="InductiveConstructor">steps</a> <a id="7203" class="Symbol">(</a><a id="7204" class="Number">0</a> <a id="7206" class="InductiveConstructor Operator">∷</a> <a id="7208" href="Data.List.Base.html#5040" class="Function Operator">[</a> <a id="7210" class="Number">1</a> <a id="7212" href="Data.List.Base.html#5040" class="Function Operator">]</a><a id="7213" class="Symbol">)</a>
  <a id="7217" class="Symbol">(</a><a id="7218" href="concurrency-language.html#991" class="InductiveConstructor">print</a> <a id="7224" class="Number">0</a> <a id="7226" href="concurrency-language.html#1050" class="InductiveConstructor Operator">,,</a> <a id="7229" href="concurrency-language.html#991" class="InductiveConstructor">print</a> <a id="7235" class="Number">1</a> <a id="7237" href="concurrency-language.html#3457" class="InductiveConstructor Operator">—→⟨</a> <a id="7241" href="concurrency-language.html#2664" class="InductiveConstructor">ξ,,∅</a> <a id="7246" href="concurrency-language.html#1486" class="InductiveConstructor">ξℕ</a> <a id="7249" href="concurrency-language.html#3457" class="InductiveConstructor Operator">⟩</a>
  <a id="7253" class="Symbol">(</a><a id="7254" href="concurrency-language.html#991" class="InductiveConstructor">print</a> <a id="7260" class="Number">1</a> <a id="7262" href="concurrency-language.html#3562" class="InductiveConstructor Operator">—→⟨⟩</a> <a id="7267" href="concurrency-language.html#1486" class="InductiveConstructor">ξℕ</a><a id="7269" class="Symbol">)))</a>
<a id="7273" class="Symbol">_</a> <a id="7275" class="Symbol">=</a> <a id="7277" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
</pre>
    </section>
</article>

        </main>

        <footer>
            Site proudly generated by
            <a style="color:yellow;" href="http://jaspervdj.be/hakyll">Hakyll</a> with
            <a style="color:yellow;" href="https://github.com/guilhermehas/guilhermehas.github.io">source code</a>
        </footer>
    </body>
</html>
