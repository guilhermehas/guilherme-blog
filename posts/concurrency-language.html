<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Guilherme Silva Blog - Concurrency language with small-step semantics</title>
        <link rel="stylesheet" href="../css/default.css" />
        <link rel="stylesheet" href="Agda.css" />
    </head>
    <body>
        <header>
            <div class="logo">
                <a href="../">Guilherme Silva</a>
            </div>
            <nav>
                <a href="../">Home</a>
                <a href="../archive.html">Archive</a>
            </nav>
        </header>

        <main role="main">
            <h1>Concurrency language with small-step semantics</h1>
            <article>
    <section class="header">
        Posted on November  3, 2021
        
            by Guilherme
        
    </section>
    <section>
        <h1 id="motivation">Motivation</h1>
<p>My motivation to formalize a concurrency programming language using small-step semantics
is to use this concept for a no deterministic programming language.</p>
<h1 id="imports">Imports</h1>
<p>Importing from <a href="https://github.com/agda/agda-stdlib">Agda standard library</a>.</p>
<pre class="Agda"><a id="364" class="Symbol">{-#</a> <a id="368" class="Keyword">OPTIONS</a> <a id="376" class="Pragma">--sized-types</a> <a id="390" class="Symbol">#-}</a>

<a id="395" class="Keyword">open</a> <a id="400" class="Keyword">import</a> <a id="407" href="Data.Bool.html" class="Module">Data.Bool</a>
<a id="417" class="Keyword">open</a> <a id="422" class="Keyword">import</a> <a id="429" href="Data.Nat.html" class="Module">Data.Nat</a>
<a id="438" class="Keyword">open</a> <a id="443" class="Keyword">import</a> <a id="450" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="488" class="Keyword">hiding</a> <a id="495" class="Symbol">(</a><a id="496" href="Relation.Binary.PropositionalEquality.html#2356" class="InductiveConstructor Operator">[_]</a><a id="499" class="Symbol">)</a>
<a id="501" class="Keyword">open</a> <a id="506" class="Keyword">import</a> <a id="513" href="Data.Product.html" class="Module">Data.Product</a>
<a id="526" class="Keyword">open</a> <a id="531" class="Keyword">import</a> <a id="538" href="Data.List.html" class="Module">Data.List</a>
<a id="548" class="Keyword">open</a> <a id="553" class="Keyword">import</a> <a id="560" href="Data.Maybe.html" class="Module">Data.Maybe</a>
<a id="571" class="Keyword">open</a> <a id="576" class="Keyword">import</a> <a id="583" href="Codata.Thunk.html" class="Module">Codata.Thunk</a>
<a id="596" class="Keyword">open</a> <a id="601" class="Keyword">import</a> <a id="608" href="Codata.Stream.html" class="Module">Codata.Stream</a> <a id="622" class="Keyword">using</a> <a id="628" class="Symbol">(</a><a id="629" href="Codata.Stream.html#900" class="Datatype">Stream</a><a id="635" class="Symbol">;</a> <a id="637" href="Codata.Stream.html#946" class="InductiveConstructor Operator">_∷_</a><a id="640" class="Symbol">;</a> <a id="642" href="Codata.Stream.html#1083" class="Function">repeat</a><a id="648" class="Symbol">)</a>
</pre>
<h1 id="defining-the-language">Defining the language</h1>
<p>The programming language is a simple command that can be a natural number,
two concurrency programs, or two programs that happen one next to the other.
In the end, the main idea is that this program just returns a list of natural numbers.</p>
<pre class="Agda"><a id="924" class="Keyword">infixr</a> <a id="931" class="Number">6</a> <a id="933" href="concurrency-language.html#1001" class="InductiveConstructor Operator">_||_</a>
<a id="938" class="Keyword">infixr</a> <a id="945" class="Number">7</a> <a id="947" href="concurrency-language.html#1038" class="InductiveConstructor Operator">_,,_</a>
<a id="952" class="Keyword">data</a> <a id="Command"></a><a id="957" href="concurrency-language.html#957" class="Datatype">Command</a> <a id="965" class="Symbol">:</a> <a id="967" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="971" class="Keyword">where</a>
  <a id="Command.print"></a><a id="979" href="concurrency-language.html#979" class="InductiveConstructor">print</a> <a id="985" class="Symbol">:</a> <a id="987" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="989" class="Symbol">→</a> <a id="991" href="concurrency-language.html#957" class="Datatype">Command</a>
  <a id="Command._||_"></a><a id="1001" href="concurrency-language.html#1001" class="InductiveConstructor Operator">_||_</a> <a id="1006" class="Symbol">:</a> <a id="1008" href="concurrency-language.html#957" class="Datatype">Command</a> <a id="1016" class="Symbol">→</a> <a id="1018" href="concurrency-language.html#957" class="Datatype">Command</a> <a id="1026" class="Symbol">→</a> <a id="1028" href="concurrency-language.html#957" class="Datatype">Command</a>
  <a id="Command._,,_"></a><a id="1038" href="concurrency-language.html#1038" class="InductiveConstructor Operator">_,,_</a> <a id="1043" class="Symbol">:</a> <a id="1045" href="concurrency-language.html#957" class="Datatype">Command</a> <a id="1053" class="Symbol">→</a> <a id="1055" href="concurrency-language.html#957" class="Datatype">Command</a> <a id="1063" class="Symbol">→</a> <a id="1065" href="concurrency-language.html#957" class="Datatype">Command</a>
</pre>
<h1 id="small-step">Small-Step</h1>
<p>Now, it will be defined the small-step semantic of this programming language:</p>
<pre class="Agda"><a id="NextCommand"></a><a id="1176" href="concurrency-language.html#1176" class="Function">NextCommand</a> <a id="1188" class="Symbol">=</a> <a id="1190" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="1192" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="1194" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="1200" href="concurrency-language.html#957" class="Datatype">Command</a>
</pre>
<p>The command will be reduced to a natural number that it produced or
maybe a new command if there is still a new program to reduce.</p>
<pre class="Agda"><a id="1349" class="Keyword">variable</a>
  <a id="1360" href="concurrency-language.html#1360" class="Generalizable">x</a> <a id="1362" href="concurrency-language.html#1362" class="Generalizable">m</a> <a id="1364" href="concurrency-language.html#1364" class="Generalizable">n</a> <a id="1366" class="Symbol">:</a> <a id="1368" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
  <a id="1372" href="concurrency-language.html#1372" class="Generalizable">xs</a> <a id="1375" href="concurrency-language.html#1375" class="Generalizable">ys</a> <a id="1378" class="Symbol">:</a> <a id="1380" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="1385" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
  <a id="1389" href="concurrency-language.html#1389" class="Generalizable">L</a> <a id="1391" href="concurrency-language.html#1391" class="Generalizable">M</a> <a id="1393" href="concurrency-language.html#1393" class="Generalizable">M'</a> <a id="1396" href="concurrency-language.html#1396" class="Generalizable">N</a> <a id="1398" href="concurrency-language.html#1398" class="Generalizable">N'</a> <a id="1401" class="Symbol">:</a> <a id="1403" href="concurrency-language.html#957" class="Datatype">Command</a>

<a id="1412" class="Keyword">infixr</a> <a id="1419" class="Number">2</a> <a id="1421" href="concurrency-language.html#1431" class="Datatype Operator">_—→_</a>
<a id="1426" class="Keyword">data</a> <a id="_—→_"></a><a id="1431" href="concurrency-language.html#1431" class="Datatype Operator">_—→_</a> <a id="1436" class="Symbol">:</a> <a id="1438" href="concurrency-language.html#957" class="Datatype">Command</a> <a id="1446" class="Symbol">→</a> <a id="1448" href="concurrency-language.html#1176" class="Function">NextCommand</a> <a id="1460" class="Symbol">→</a> <a id="1462" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1466" class="Keyword">where</a>
  <a id="_—→_.ξℕ"></a><a id="1474" href="concurrency-language.html#1474" class="InductiveConstructor">ξℕ</a> <a id="1477" class="Symbol">:</a> <a id="1479" href="concurrency-language.html#979" class="InductiveConstructor">print</a> <a id="1485" href="concurrency-language.html#1364" class="Generalizable">n</a> <a id="1487" href="concurrency-language.html#1431" class="Datatype Operator">—→</a> <a id="1490" href="concurrency-language.html#1364" class="Generalizable">n</a> <a id="1492" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1494" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>
</pre>
<p>The simplest reduction is when there is a simple program with just a natural number.
This program will be reduced to it and there is no program remaining.</p>
<pre class="Agda">  <a id="_—→_.ξ||ₗ"></a><a id="1669" href="concurrency-language.html#1669" class="InductiveConstructor">ξ||ₗ</a> <a id="1674" class="Symbol">:</a> <a id="1676" href="concurrency-language.html#1391" class="Generalizable">M</a> <a id="1678" href="concurrency-language.html#1431" class="Datatype Operator">—→</a> <a id="1681" href="concurrency-language.html#1362" class="Generalizable">m</a> <a id="1683" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1685" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="1690" href="concurrency-language.html#1393" class="Generalizable">M'</a>
         <a id="1702" class="Comment">------------------------------</a>
         <a id="1742" class="Symbol">→</a> <a id="1744" href="concurrency-language.html#1391" class="Generalizable">M</a> <a id="1746" href="concurrency-language.html#1001" class="InductiveConstructor Operator">||</a> <a id="1749" href="concurrency-language.html#1396" class="Generalizable">N</a> <a id="1751" href="concurrency-language.html#1431" class="Datatype Operator">—→</a> <a id="1754" href="concurrency-language.html#1362" class="Generalizable">m</a> <a id="1756" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1758" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="1763" class="Symbol">(</a><a id="1764" href="concurrency-language.html#1393" class="Generalizable">M'</a> <a id="1767" href="concurrency-language.html#1001" class="InductiveConstructor Operator">||</a> <a id="1770" href="concurrency-language.html#1396" class="Generalizable">N</a><a id="1771" class="Symbol">)</a>
</pre>
<p>If there is a parallel program, the left program will be reduced by one step.</p>
<pre class="Agda">  <a id="_—→_.ξ||∅ₗ"></a><a id="1863" href="concurrency-language.html#1863" class="InductiveConstructor">ξ||∅ₗ</a> <a id="1869" class="Symbol">:</a> <a id="1871" href="concurrency-language.html#1391" class="Generalizable">M</a> <a id="1873" href="concurrency-language.html#1431" class="Datatype Operator">—→</a> <a id="1876" href="concurrency-language.html#1362" class="Generalizable">m</a> <a id="1878" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1880" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>
          <a id="1898" class="Comment">----------------------</a>
          <a id="1931" class="Symbol">→</a> <a id="1933" href="concurrency-language.html#1391" class="Generalizable">M</a> <a id="1935" href="concurrency-language.html#1001" class="InductiveConstructor Operator">||</a> <a id="1938" href="concurrency-language.html#1396" class="Generalizable">N</a> <a id="1940" href="concurrency-language.html#1431" class="Datatype Operator">—→</a> <a id="1943" href="concurrency-language.html#1362" class="Generalizable">m</a> <a id="1945" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1947" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="1952" href="concurrency-language.html#1396" class="Generalizable">N</a>
</pre>
<p>The new program after the left ends in the parallel program is just the right program.</p>
<pre class="Agda">  <a id="_—→_.ξ||ᵣ"></a><a id="2053" href="concurrency-language.html#2053" class="InductiveConstructor">ξ||ᵣ</a> <a id="2058" class="Symbol">:</a> <a id="2060" href="concurrency-language.html#1396" class="Generalizable">N</a> <a id="2062" href="concurrency-language.html#1431" class="Datatype Operator">—→</a> <a id="2065" href="concurrency-language.html#1364" class="Generalizable">n</a> <a id="2067" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2069" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2074" href="concurrency-language.html#1398" class="Generalizable">N'</a>
         <a id="2086" class="Comment">------------------------------</a>
         <a id="2126" class="Symbol">→</a> <a id="2128" href="concurrency-language.html#1391" class="Generalizable">M</a> <a id="2130" href="concurrency-language.html#1001" class="InductiveConstructor Operator">||</a> <a id="2133" href="concurrency-language.html#1396" class="Generalizable">N</a> <a id="2135" href="concurrency-language.html#1431" class="Datatype Operator">—→</a> <a id="2138" href="concurrency-language.html#1364" class="Generalizable">n</a> <a id="2140" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2142" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2147" class="Symbol">(</a><a id="2148" href="concurrency-language.html#1391" class="Generalizable">M</a> <a id="2150" href="concurrency-language.html#1001" class="InductiveConstructor Operator">||</a> <a id="2153" href="concurrency-language.html#1398" class="Generalizable">N'</a><a id="2155" class="Symbol">)</a>
</pre>
<p>It is the same thing of a previous step but for the right program.</p>
<pre class="Agda">  <a id="_—→_.ξ||∅ᵣ"></a><a id="2236" href="concurrency-language.html#2236" class="InductiveConstructor">ξ||∅ᵣ</a> <a id="2242" class="Symbol">:</a> <a id="2244" href="concurrency-language.html#1396" class="Generalizable">N</a> <a id="2246" href="concurrency-language.html#1431" class="Datatype Operator">—→</a> <a id="2249" href="concurrency-language.html#1364" class="Generalizable">n</a> <a id="2251" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2253" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>
          <a id="2271" class="Comment">----------------------</a>
          <a id="2304" class="Symbol">→</a> <a id="2306" href="concurrency-language.html#1391" class="Generalizable">M</a> <a id="2308" href="concurrency-language.html#1001" class="InductiveConstructor Operator">||</a> <a id="2311" href="concurrency-language.html#1396" class="Generalizable">N</a> <a id="2313" href="concurrency-language.html#1431" class="Datatype Operator">—→</a> <a id="2316" href="concurrency-language.html#1364" class="Generalizable">n</a> <a id="2318" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2320" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2325" href="concurrency-language.html#1391" class="Generalizable">M</a>
</pre>
<p>It is the same thing as a previous step but for the right program.</p>
<pre class="Agda">  <a id="_—→_.ξ,,"></a><a id="2406" href="concurrency-language.html#2406" class="InductiveConstructor">ξ,,</a> <a id="2410" class="Symbol">:</a> <a id="2412" href="concurrency-language.html#1391" class="Generalizable">M</a> <a id="2414" href="concurrency-language.html#1431" class="Datatype Operator">—→</a> <a id="2417" href="concurrency-language.html#1362" class="Generalizable">m</a> <a id="2419" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2421" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2426" href="concurrency-language.html#1393" class="Generalizable">M'</a>
       <a id="2436" class="Comment">-----------------------------</a>
       <a id="2473" class="Symbol">→</a> <a id="2475" href="concurrency-language.html#1391" class="Generalizable">M</a> <a id="2477" href="concurrency-language.html#1038" class="InductiveConstructor Operator">,,</a> <a id="2480" href="concurrency-language.html#1396" class="Generalizable">N</a> <a id="2482" href="concurrency-language.html#1431" class="Datatype Operator">—→</a> <a id="2485" href="concurrency-language.html#1362" class="Generalizable">m</a> <a id="2487" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2489" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2494" class="Symbol">(</a><a id="2495" href="concurrency-language.html#1393" class="Generalizable">M'</a> <a id="2498" href="concurrency-language.html#1038" class="InductiveConstructor Operator">,,</a> <a id="2501" href="concurrency-language.html#1396" class="Generalizable">N</a><a id="2502" class="Symbol">)</a>
</pre>
<p>When there is a sequence program, the left part is reduced once and the rest of the command
is just the join of both of these programs.</p>
<pre class="Agda">  <a id="_—→_.ξ,,∅"></a><a id="2652" href="concurrency-language.html#2652" class="InductiveConstructor">ξ,,∅</a> <a id="2657" class="Symbol">:</a> <a id="2659" href="concurrency-language.html#1391" class="Generalizable">M</a> <a id="2661" href="concurrency-language.html#1431" class="Datatype Operator">—→</a> <a id="2664" href="concurrency-language.html#1362" class="Generalizable">m</a> <a id="2666" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2668" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>
       <a id="2683" class="Comment">----------------------</a>
       <a id="2713" class="Symbol">→</a> <a id="2715" href="concurrency-language.html#1391" class="Generalizable">M</a> <a id="2717" href="concurrency-language.html#1038" class="InductiveConstructor Operator">,,</a> <a id="2720" href="concurrency-language.html#1396" class="Generalizable">N</a> <a id="2722" href="concurrency-language.html#1431" class="Datatype Operator">—→</a> <a id="2725" href="concurrency-language.html#1362" class="Generalizable">m</a> <a id="2727" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2729" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2734" href="concurrency-language.html#1396" class="Generalizable">N</a>
</pre>
<p>When the left program ends, the rest of the program is the right one.</p>
<p>In this example, a parallel program can be reduced in two ways:</p>
<pre class="Agda"><a id="||prog"></a><a id="2881" href="concurrency-language.html#2881" class="Function">||prog</a> <a id="2888" class="Symbol">=</a> <a id="2890" href="concurrency-language.html#979" class="InductiveConstructor">print</a> <a id="2896" class="Number">0</a> <a id="2898" href="concurrency-language.html#1001" class="InductiveConstructor Operator">||</a> <a id="2901" href="concurrency-language.html#979" class="InductiveConstructor">print</a> <a id="2907" class="Number">1</a>

<a id="2910" href="concurrency-language.html#2910" class="Function">_</a> <a id="2912" class="Symbol">:</a> <a id="2914" href="concurrency-language.html#2881" class="Function">||prog</a> <a id="2921" href="concurrency-language.html#1431" class="Datatype Operator">—→</a> <a id="2924" class="Number">0</a> <a id="2926" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2928" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2933" class="Symbol">(</a><a id="2934" href="concurrency-language.html#979" class="InductiveConstructor">print</a> <a id="2940" class="Number">1</a><a id="2941" class="Symbol">)</a>
<a id="2943" class="Symbol">_</a> <a id="2945" class="Symbol">=</a> <a id="2947" href="concurrency-language.html#1863" class="InductiveConstructor">ξ||∅ₗ</a> <a id="2953" href="concurrency-language.html#1474" class="InductiveConstructor">ξℕ</a>

<a id="2957" href="concurrency-language.html#2957" class="Function">_</a> <a id="2959" class="Symbol">:</a> <a id="2961" href="concurrency-language.html#2881" class="Function">||prog</a> <a id="2968" href="concurrency-language.html#1431" class="Datatype Operator">—→</a> <a id="2971" class="Number">1</a> <a id="2973" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2975" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="2980" class="Symbol">(</a><a id="2981" href="concurrency-language.html#979" class="InductiveConstructor">print</a> <a id="2987" class="Number">0</a><a id="2988" class="Symbol">)</a>
<a id="2990" class="Symbol">_</a> <a id="2992" class="Symbol">=</a> <a id="2994" href="concurrency-language.html#2236" class="InductiveConstructor">ξ||∅ᵣ</a> <a id="3000" href="concurrency-language.html#1474" class="InductiveConstructor">ξℕ</a>
</pre>
<h1 id="multi-step">Multi-step</h1>
<p>Now, it will be defined the multi-step of the language.
It can be a zero-step, so a command <code>M</code> can go to <code>M</code> (<code>M —↠ M</code>),
it can be multiple steps (that can be one, two, or any natural number)
or it can be a step that the command finishes.</p>
<pre class="Agda"><a id="3267" class="Keyword">infix</a>  <a id="3274" class="Number">2</a> <a id="3276" href="concurrency-language.html#3332" class="Datatype Operator">_—↠_</a>
<a id="3281" class="Keyword">infix</a>  <a id="3288" class="Number">1</a> <a id="3290" href="concurrency-language.html#3641" class="Function Operator">begin_</a>
<a id="3297" class="Keyword">infixr</a> <a id="3304" class="Number">2</a> <a id="3306" href="concurrency-language.html#3445" class="InductiveConstructor Operator">_—→⟨_⟩_</a>
<a id="3314" class="Keyword">infix</a>  <a id="3321" class="Number">3</a> <a id="3323" href="concurrency-language.html#3387" class="InductiveConstructor Operator">_∎</a>

<a id="3327" class="Keyword">data</a> <a id="_—↠_"></a><a id="3332" href="concurrency-language.html#3332" class="Datatype Operator">_—↠_</a> <a id="3337" class="Symbol">:</a> <a id="3339" href="concurrency-language.html#957" class="Datatype">Command</a> <a id="3347" class="Symbol">→</a> <a id="3349" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3354" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="3356" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="3358" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="3364" href="concurrency-language.html#957" class="Datatype">Command</a> <a id="3372" class="Symbol">→</a> <a id="3374" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="3378" class="Keyword">where</a>

  <a id="_—↠_._∎"></a><a id="3387" href="concurrency-language.html#3387" class="InductiveConstructor Operator">_∎</a> <a id="3390" class="Symbol">:</a> <a id="3392" class="Symbol">∀</a> <a id="3394" href="concurrency-language.html#3394" class="Bound">M</a>
      <a id="3402" class="Comment">----------------</a>
    <a id="3423" class="Symbol">→</a> <a id="3425" href="concurrency-language.html#3394" class="Bound">M</a> <a id="3427" href="concurrency-language.html#3332" class="Datatype Operator">—↠</a> <a id="3430" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="3433" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3435" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="3440" href="concurrency-language.html#3394" class="Bound">M</a>

  <a id="_—↠_._—→⟨_⟩_"></a><a id="3445" href="concurrency-language.html#3445" class="InductiveConstructor Operator">_—→⟨_⟩_</a> <a id="3453" class="Symbol">:</a> <a id="3455" class="Symbol">∀</a> <a id="3457" href="concurrency-language.html#3457" class="Bound">L</a> <a id="3459" class="Symbol">{</a><a id="3460" href="concurrency-language.html#3460" class="Bound">N</a><a id="3461" class="Symbol">}</a>
    <a id="3467" class="Symbol">→</a> <a id="3469" href="concurrency-language.html#3457" class="Bound">L</a> <a id="3471" href="concurrency-language.html#1431" class="Datatype Operator">—→</a> <a id="3474" href="concurrency-language.html#1360" class="Generalizable">x</a> <a id="3476" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3478" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="3483" href="concurrency-language.html#1391" class="Generalizable">M</a>
    <a id="3489" class="Symbol">→</a> <a id="3491" href="concurrency-language.html#1391" class="Generalizable">M</a> <a id="3493" href="concurrency-language.html#3332" class="Datatype Operator">—↠</a> <a id="3496" href="concurrency-language.html#1372" class="Generalizable">xs</a> <a id="3499" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3501" href="concurrency-language.html#3460" class="Bound">N</a>
      <a id="3509" class="Comment">---------------</a>
    <a id="3529" class="Symbol">→</a> <a id="3531" href="concurrency-language.html#3457" class="Bound">L</a> <a id="3533" href="concurrency-language.html#3332" class="Datatype Operator">—↠</a> <a id="3536" href="concurrency-language.html#1360" class="Generalizable">x</a> <a id="3538" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3540" href="concurrency-language.html#1372" class="Generalizable">xs</a> <a id="3543" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3545" href="concurrency-language.html#3460" class="Bound">N</a>

  <a id="_—↠_._—→⟨⟩_"></a><a id="3550" href="concurrency-language.html#3550" class="InductiveConstructor Operator">_—→⟨⟩_</a> <a id="3557" class="Symbol">:</a> <a id="3559" class="Symbol">∀</a> <a id="3561" href="concurrency-language.html#3561" class="Bound">L</a>
    <a id="3567" class="Symbol">→</a> <a id="3569" href="concurrency-language.html#3561" class="Bound">L</a> <a id="3571" href="concurrency-language.html#1431" class="Datatype Operator">—→</a> <a id="3574" href="concurrency-language.html#1360" class="Generalizable">x</a> <a id="3576" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3578" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>
      <a id="3592" class="Comment">--------------------</a>
    <a id="3617" class="Symbol">→</a> <a id="3619" href="concurrency-language.html#3561" class="Bound">L</a> <a id="3621" href="concurrency-language.html#3332" class="Datatype Operator">—↠</a> <a id="3624" href="Data.List.Base.html#5025" class="Function Operator">[</a> <a id="3626" href="concurrency-language.html#1360" class="Generalizable">x</a> <a id="3628" href="Data.List.Base.html#5025" class="Function Operator">]</a> <a id="3630" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3632" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>

<a id="begin_"></a><a id="3641" href="concurrency-language.html#3641" class="Function Operator">begin_</a> <a id="3648" class="Symbol">:</a> <a id="3650" class="Symbol">∀</a> <a id="3652" class="Symbol">{</a><a id="3653" href="concurrency-language.html#3653" class="Bound">N</a><a id="3654" class="Symbol">}</a>
  <a id="3658" class="Symbol">→</a> <a id="3660" href="concurrency-language.html#1391" class="Generalizable">M</a> <a id="3662" href="concurrency-language.html#3332" class="Datatype Operator">—↠</a> <a id="3665" href="concurrency-language.html#3653" class="Bound">N</a>
    <a id="3671" class="Comment">------</a>
  <a id="3680" class="Symbol">→</a> <a id="3682" href="concurrency-language.html#1391" class="Generalizable">M</a> <a id="3684" href="concurrency-language.html#3332" class="Datatype Operator">—↠</a> <a id="3687" href="concurrency-language.html#3653" class="Bound">N</a>
<a id="3689" href="concurrency-language.html#3641" class="Function Operator">begin</a> <a id="3695" href="concurrency-language.html#3695" class="Bound">M—↠N</a> <a id="3700" class="Symbol">=</a> <a id="3702" href="concurrency-language.html#3695" class="Bound">M—↠N</a>
</pre>
<p>When the command evaluates to nothing, it finishes:</p>
<pre class="Agda"><a id="3769" class="Keyword">infix</a> <a id="3775" class="Number">2</a> <a id="3777" href="concurrency-language.html#3782" class="Function Operator">_—⇀_</a>
<a id="_—⇀_"></a><a id="3782" href="concurrency-language.html#3782" class="Function Operator">_—⇀_</a> <a id="3787" class="Symbol">:</a> <a id="3789" href="concurrency-language.html#957" class="Datatype">Command</a> <a id="3797" class="Symbol">→</a> <a id="3799" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="3804" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="3806" class="Symbol">→</a> <a id="3808" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="3812" href="concurrency-language.html#3812" class="Bound">L</a> <a id="3814" href="concurrency-language.html#3782" class="Function Operator">—⇀</a> <a id="3817" href="concurrency-language.html#3817" class="Bound">xs</a> <a id="3820" class="Symbol">=</a> <a id="3822" href="concurrency-language.html#3812" class="Bound">L</a> <a id="3824" href="concurrency-language.html#3332" class="Datatype Operator">—↠</a> <a id="3827" href="concurrency-language.html#3817" class="Bound">xs</a> <a id="3830" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3832" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>
</pre>
<p>This is a small lemma that you can concatenate the result of two sequence commands:</p>
<pre class="Agda"><a id=",,-sequence"></a><a id="3934" href="concurrency-language.html#3934" class="Function">,,-sequence</a> <a id="3946" class="Symbol">:</a>
    <a id="3952" href="concurrency-language.html#1391" class="Generalizable">M</a> <a id="3954" href="concurrency-language.html#3782" class="Function Operator">—⇀</a> <a id="3957" href="concurrency-language.html#1372" class="Generalizable">xs</a>
  <a id="3962" class="Symbol">→</a> <a id="3964" href="concurrency-language.html#1396" class="Generalizable">N</a> <a id="3966" href="concurrency-language.html#3782" class="Function Operator">—⇀</a> <a id="3969" href="concurrency-language.html#1375" class="Generalizable">ys</a>
  <a id="3974" class="Symbol">→</a> <a id="3976" href="concurrency-language.html#1391" class="Generalizable">M</a> <a id="3978" href="concurrency-language.html#1038" class="InductiveConstructor Operator">,,</a> <a id="3981" href="concurrency-language.html#1396" class="Generalizable">N</a> <a id="3983" href="concurrency-language.html#3782" class="Function Operator">—⇀</a> <a id="3986" href="concurrency-language.html#1372" class="Generalizable">xs</a> <a id="3989" href="Data.List.Base.html#1810" class="Function Operator">++</a> <a id="3992" href="concurrency-language.html#1375" class="Generalizable">ys</a>
<a id="3995" href="concurrency-language.html#3934" class="Function">,,-sequence</a> <a id="4007" class="Symbol">(_</a> <a id="4010" href="concurrency-language.html#3550" class="InductiveConstructor Operator">—→⟨⟩</a> <a id="4015" href="concurrency-language.html#4015" class="Bound">st1</a><a id="4018" class="Symbol">)</a> <a id="4020" href="concurrency-language.html#4020" class="Bound">st2</a> <a id="4024" class="Symbol">=</a> <a id="4026" class="Symbol">_</a> <a id="4028" href="concurrency-language.html#1038" class="InductiveConstructor Operator">,,</a> <a id="4031" class="Symbol">_</a> <a id="4033" href="concurrency-language.html#3445" class="InductiveConstructor Operator">—→⟨</a> <a id="4037" href="concurrency-language.html#2652" class="InductiveConstructor">ξ,,∅</a> <a id="4042" href="concurrency-language.html#4015" class="Bound">st1</a> <a id="4046" href="concurrency-language.html#3445" class="InductiveConstructor Operator">⟩</a> <a id="4048" href="concurrency-language.html#4020" class="Bound">st2</a>
<a id="4052" href="concurrency-language.html#3934" class="Function">,,-sequence</a> <a id="4064" class="Symbol">(_</a> <a id="4067" href="concurrency-language.html#3445" class="InductiveConstructor Operator">—→⟨</a> <a id="4071" href="concurrency-language.html#4071" class="Bound">st</a> <a id="4074" href="concurrency-language.html#3445" class="InductiveConstructor Operator">⟩</a> <a id="4076" href="concurrency-language.html#4076" class="Bound">st1</a><a id="4079" class="Symbol">)</a> <a id="4081" href="concurrency-language.html#4081" class="Bound">st2</a> <a id="4085" class="Symbol">=</a> <a id="4087" class="Symbol">_</a> <a id="4089" href="concurrency-language.html#1038" class="InductiveConstructor Operator">,,</a> <a id="4092" class="Symbol">_</a> <a id="4094" href="concurrency-language.html#3445" class="InductiveConstructor Operator">—→⟨</a> <a id="4098" href="concurrency-language.html#2406" class="InductiveConstructor">ξ,,</a> <a id="4102" href="concurrency-language.html#4071" class="Bound">st</a> <a id="4105" href="concurrency-language.html#3445" class="InductiveConstructor Operator">⟩</a> <a id="4107" href="concurrency-language.html#3934" class="Function">,,-sequence</a> <a id="4119" href="concurrency-language.html#4076" class="Bound">st1</a> <a id="4123" href="concurrency-language.html#4081" class="Bound">st2</a>
</pre>
<h1 id="single-step">Single-step</h1>
<p>The single-step is just the small step that you hide the result of the small step in the type.</p>
<pre class="Agda"><a id="4247" class="Keyword">data</a> <a id="SingleStep"></a><a id="4252" href="concurrency-language.html#4252" class="Datatype">SingleStep</a> <a id="4263" class="Symbol">:</a> <a id="4265" href="concurrency-language.html#957" class="Datatype">Command</a> <a id="4273" class="Symbol">→</a> <a id="4275" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="4279" class="Keyword">where</a>
  <a id="SingleStep.singleStep"></a><a id="4287" href="concurrency-language.html#4287" class="InductiveConstructor">singleStep</a> <a id="4298" class="Symbol">:</a> <a id="4300" class="Symbol">∀</a> <a id="4302" href="concurrency-language.html#4302" class="Bound">n</a> <a id="4304" href="concurrency-language.html#4304" class="Bound">L'</a>
    <a id="4311" class="Symbol">→</a> <a id="4313" href="concurrency-language.html#1389" class="Generalizable">L</a> <a id="4315" href="concurrency-language.html#1431" class="Datatype Operator">—→</a> <a id="4318" href="concurrency-language.html#4302" class="Bound">n</a> <a id="4320" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4322" href="concurrency-language.html#4304" class="Bound">L'</a>
      <a id="4331" class="Comment">----------</a>
    <a id="4346" class="Symbol">→</a> <a id="4348" href="concurrency-language.html#4252" class="Datatype">SingleStep</a> <a id="4359" href="concurrency-language.html#1389" class="Generalizable">L</a>
</pre>
<p>With the eval step, I prove that every command has a single step associated with that.
If the program is parallel, it will consume a boolean from the stream and
this boolean represents which part of the program will be evaluated.
The false represents the left part while true represents the right.</p>
<pre class="Agda"><a id="eval-step"></a><a id="4669" href="concurrency-language.html#4669" class="Function">eval-step</a> <a id="4679" class="Symbol">:</a>
  <a id="4683" href="Codata.Stream.html#900" class="Datatype">Stream</a> <a id="4690" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a> <a id="4695" class="Symbol">_</a>
  <a id="4699" class="Symbol">→</a> <a id="4701" class="Symbol">(</a><a id="4702" href="concurrency-language.html#4702" class="Bound">L</a> <a id="4704" class="Symbol">:</a> <a id="4706" href="concurrency-language.html#957" class="Datatype">Command</a><a id="4713" class="Symbol">)</a>
  <a id="4717" class="Symbol">→</a> <a id="4719" href="Codata.Stream.html#900" class="Datatype">Stream</a> <a id="4726" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a> <a id="4731" class="Symbol">_</a> <a id="4733" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="4735" href="concurrency-language.html#4252" class="Datatype">SingleStep</a> <a id="4746" href="concurrency-language.html#4702" class="Bound">L</a>
<a id="4748" href="concurrency-language.html#4669" class="Function">eval-step</a> <a id="4758" href="concurrency-language.html#4758" class="Bound">sxs</a> <a id="4762" class="Symbol">(</a><a id="4763" href="concurrency-language.html#979" class="InductiveConstructor">print</a> <a id="4769" href="concurrency-language.html#4769" class="Bound">x</a><a id="4770" class="Symbol">)</a> <a id="4772" class="Symbol">=</a> <a id="4774" href="concurrency-language.html#4758" class="Bound">sxs</a> <a id="4778" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4780" class="Symbol">(</a><a id="4781" href="concurrency-language.html#4287" class="InductiveConstructor">singleStep</a> <a id="4792" href="concurrency-language.html#4769" class="Bound">x</a> <a id="4794" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="4802" href="concurrency-language.html#1474" class="InductiveConstructor">ξℕ</a><a id="4804" class="Symbol">)</a>
<a id="4806" href="concurrency-language.html#4669" class="Function">eval-step</a> <a id="4816" href="concurrency-language.html#4816" class="Bound">sxs</a> <a id="4820" class="Symbol">(</a><a id="4821" href="concurrency-language.html#4821" class="Bound">M</a> <a id="4823" href="concurrency-language.html#1038" class="InductiveConstructor Operator">,,</a> <a id="4826" href="concurrency-language.html#4826" class="Bound">N</a><a id="4827" class="Symbol">)</a> <a id="4829" class="Keyword">with</a> <a id="4834" href="concurrency-language.html#4669" class="Function">eval-step</a> <a id="4844" href="concurrency-language.html#4816" class="Bound">sxs</a> <a id="4848" href="concurrency-language.html#4821" class="Bound">M</a>
<a id="4850" class="Symbol">...</a> <a id="4854" class="Symbol">|</a> <a id="4856" href="concurrency-language.html#4856" class="Bound">sys</a> <a id="4860" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4862" href="concurrency-language.html#4287" class="InductiveConstructor">singleStep</a> <a id="4873" href="concurrency-language.html#4873" class="Bound">n</a> <a id="4875" class="Symbol">(</a><a id="4876" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="4881" href="concurrency-language.html#4881" class="Bound">M'</a><a id="4883" class="Symbol">)</a> <a id="4885" href="concurrency-language.html#4885" class="Bound">st</a> <a id="4888" class="Symbol">=</a> <a id="4890" href="concurrency-language.html#4856" class="Bound">sys</a> <a id="4894" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4896" class="Symbol">(</a><a id="4897" href="concurrency-language.html#4287" class="InductiveConstructor">singleStep</a> <a id="4908" href="concurrency-language.html#4873" class="Bound">n</a> <a id="4910" class="Symbol">(</a><a id="4911" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="4916" class="Symbol">(</a><a id="4917" href="concurrency-language.html#4881" class="Bound">M'</a> <a id="4920" href="concurrency-language.html#1038" class="InductiveConstructor Operator">,,</a> <a id="4923" class="Bound">N</a><a id="4924" class="Symbol">))</a> <a id="4927" class="Symbol">(</a><a id="4928" href="concurrency-language.html#2406" class="InductiveConstructor">ξ,,</a> <a id="4932" href="concurrency-language.html#4885" class="Bound">st</a><a id="4934" class="Symbol">))</a>
<a id="4937" class="Symbol">...</a> <a id="4941" class="Symbol">|</a> <a id="4943" href="concurrency-language.html#4943" class="Bound">sys</a> <a id="4947" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4949" href="concurrency-language.html#4287" class="InductiveConstructor">singleStep</a> <a id="4960" href="concurrency-language.html#4960" class="Bound">n</a> <a id="4962" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="4970" href="concurrency-language.html#4970" class="Bound">st</a> <a id="4973" class="Symbol">=</a> <a id="4975" href="concurrency-language.html#4943" class="Bound">sys</a> <a id="4979" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4981" class="Symbol">(</a><a id="4982" href="concurrency-language.html#4287" class="InductiveConstructor">singleStep</a> <a id="4993" href="concurrency-language.html#4960" class="Bound">n</a> <a id="4995" class="Symbol">(</a><a id="4996" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="5001" class="Bound">N</a><a id="5002" class="Symbol">)</a> <a id="5004" class="Symbol">(</a><a id="5005" href="concurrency-language.html#2652" class="InductiveConstructor">ξ,,∅</a> <a id="5010" href="concurrency-language.html#4970" class="Bound">st</a><a id="5012" class="Symbol">))</a>
<a id="5015" href="concurrency-language.html#4669" class="Function">eval-step</a> <a id="5025" class="Symbol">(</a><a id="5026" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a> <a id="5032" href="Codata.Stream.html#946" class="InductiveConstructor Operator">∷</a> <a id="5034" href="concurrency-language.html#5034" class="Bound">sxs</a><a id="5037" class="Symbol">)</a> <a id="5039" class="Symbol">(</a><a id="5040" href="concurrency-language.html#5040" class="Bound">M</a> <a id="5042" href="concurrency-language.html#1001" class="InductiveConstructor Operator">||</a> <a id="5045" href="concurrency-language.html#5045" class="Bound">N</a><a id="5046" class="Symbol">)</a> <a id="5048" class="Keyword">with</a> <a id="5053" href="concurrency-language.html#4669" class="Function">eval-step</a> <a id="5063" class="Symbol">(</a><a id="5064" href="concurrency-language.html#5034" class="Bound">sxs</a> <a id="5068" class="Symbol">.</a><a id="5069" href="Codata.Thunk.html#541" class="Field">force</a><a id="5074" class="Symbol">)</a> <a id="5076" href="concurrency-language.html#5040" class="Bound">M</a>
<a id="5078" class="Symbol">...</a> <a id="5082" class="Symbol">|</a> <a id="5084" href="concurrency-language.html#5084" class="Bound">sys</a> <a id="5088" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5090" href="concurrency-language.html#4287" class="InductiveConstructor">singleStep</a> <a id="5101" href="concurrency-language.html#5101" class="Bound">n</a> <a id="5103" class="Symbol">(</a><a id="5104" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="5109" href="concurrency-language.html#5109" class="Bound">M'</a><a id="5111" class="Symbol">)</a> <a id="5113" href="concurrency-language.html#5113" class="Bound">st</a> <a id="5116" class="Symbol">=</a> <a id="5118" href="concurrency-language.html#5084" class="Bound">sys</a> <a id="5122" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5124" class="Symbol">(</a><a id="5125" href="concurrency-language.html#4287" class="InductiveConstructor">singleStep</a> <a id="5136" href="concurrency-language.html#5101" class="Bound">n</a> <a id="5138" class="Symbol">(</a><a id="5139" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="5144" class="Symbol">(</a><a id="5145" href="concurrency-language.html#5109" class="Bound">M'</a> <a id="5148" href="concurrency-language.html#1001" class="InductiveConstructor Operator">||</a> <a id="5151" class="Bound">N</a><a id="5152" class="Symbol">)</a> <a id="5154" class="Symbol">)</a> <a id="5156" class="Symbol">(</a><a id="5157" href="concurrency-language.html#1669" class="InductiveConstructor">ξ||ₗ</a> <a id="5162" href="concurrency-language.html#5113" class="Bound">st</a><a id="5164" class="Symbol">))</a>
<a id="5167" class="Symbol">...</a> <a id="5171" class="Symbol">|</a> <a id="5173" href="concurrency-language.html#5173" class="Bound">sys</a> <a id="5177" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5179" href="concurrency-language.html#4287" class="InductiveConstructor">singleStep</a> <a id="5190" href="concurrency-language.html#5190" class="Bound">n</a> <a id="5192" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="5200" href="concurrency-language.html#5200" class="Bound">st</a> <a id="5203" class="Symbol">=</a> <a id="5205" href="concurrency-language.html#5173" class="Bound">sys</a> <a id="5209" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5211" class="Symbol">(</a><a id="5212" href="concurrency-language.html#4287" class="InductiveConstructor">singleStep</a> <a id="5223" href="concurrency-language.html#5190" class="Bound">n</a> <a id="5225" class="Symbol">(</a><a id="5226" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="5231" class="Bound">N</a><a id="5232" class="Symbol">)</a> <a id="5234" class="Symbol">(</a><a id="5235" href="concurrency-language.html#1863" class="InductiveConstructor">ξ||∅ₗ</a> <a id="5241" href="concurrency-language.html#5200" class="Bound">st</a><a id="5243" class="Symbol">))</a>
<a id="5246" href="concurrency-language.html#4669" class="Function">eval-step</a> <a id="5256" class="Symbol">(</a><a id="5257" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a> <a id="5262" href="Codata.Stream.html#946" class="InductiveConstructor Operator">∷</a> <a id="5264" href="concurrency-language.html#5264" class="Bound">sxs</a><a id="5267" class="Symbol">)</a> <a id="5269" class="Symbol">(</a><a id="5270" href="concurrency-language.html#5270" class="Bound">M</a> <a id="5272" href="concurrency-language.html#1001" class="InductiveConstructor Operator">||</a> <a id="5275" href="concurrency-language.html#5275" class="Bound">N</a><a id="5276" class="Symbol">)</a> <a id="5278" class="Keyword">with</a> <a id="5283" href="concurrency-language.html#4669" class="Function">eval-step</a> <a id="5293" class="Symbol">(</a><a id="5294" href="concurrency-language.html#5264" class="Bound">sxs</a> <a id="5298" class="Symbol">.</a><a id="5299" href="Codata.Thunk.html#541" class="Field">force</a><a id="5304" class="Symbol">)</a> <a id="5306" href="concurrency-language.html#5275" class="Bound">N</a>
<a id="5308" class="Symbol">...</a> <a id="5312" class="Symbol">|</a> <a id="5314" href="concurrency-language.html#5314" class="Bound">sys</a> <a id="5318" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5320" href="concurrency-language.html#4287" class="InductiveConstructor">singleStep</a> <a id="5331" href="concurrency-language.html#5331" class="Bound">n</a> <a id="5333" class="Symbol">(</a><a id="5334" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="5339" href="concurrency-language.html#5339" class="Bound">N'</a><a id="5341" class="Symbol">)</a> <a id="5343" href="concurrency-language.html#5343" class="Bound">st</a> <a id="5346" class="Symbol">=</a> <a id="5348" href="concurrency-language.html#5314" class="Bound">sys</a> <a id="5352" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5354" class="Symbol">(</a><a id="5355" href="concurrency-language.html#4287" class="InductiveConstructor">singleStep</a> <a id="5366" href="concurrency-language.html#5331" class="Bound">n</a> <a id="5368" class="Symbol">(</a><a id="5369" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="5374" class="Symbol">(</a><a id="5375" class="Bound">M</a> <a id="5377" href="concurrency-language.html#1001" class="InductiveConstructor Operator">||</a> <a id="5380" href="concurrency-language.html#5339" class="Bound">N'</a><a id="5382" class="Symbol">)</a> <a id="5384" class="Symbol">)</a> <a id="5386" class="Symbol">(</a><a id="5387" href="concurrency-language.html#2053" class="InductiveConstructor">ξ||ᵣ</a> <a id="5392" href="concurrency-language.html#5343" class="Bound">st</a><a id="5394" class="Symbol">))</a>
<a id="5397" class="Symbol">...</a> <a id="5401" class="Symbol">|</a> <a id="5403" href="concurrency-language.html#5403" class="Bound">sys</a> <a id="5407" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5409" href="concurrency-language.html#4287" class="InductiveConstructor">singleStep</a> <a id="5420" href="concurrency-language.html#5420" class="Bound">n</a> <a id="5422" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="5430" href="concurrency-language.html#5430" class="Bound">st</a> <a id="5433" class="Symbol">=</a> <a id="5435" href="concurrency-language.html#5403" class="Bound">sys</a> <a id="5439" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5441" class="Symbol">(</a><a id="5442" href="concurrency-language.html#4287" class="InductiveConstructor">singleStep</a> <a id="5453" href="concurrency-language.html#5420" class="Bound">n</a> <a id="5455" class="Symbol">(</a><a id="5456" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="5461" class="Bound">M</a><a id="5462" class="Symbol">)</a> <a id="5464" class="Symbol">(</a><a id="5465" href="concurrency-language.html#2236" class="InductiveConstructor">ξ||∅ᵣ</a> <a id="5471" href="concurrency-language.html#5430" class="Bound">st</a><a id="5473" class="Symbol">))</a>
</pre>
<h1 id="evaluation">Evaluation</h1>
<p>For the definition of evaluation, it will necessary to be defined when an
command was finished in the evaluation and the steps of the evaluation.</p>
<pre class="Agda"><a id="5646" class="Keyword">data</a> <a id="Steps"></a><a id="5651" href="concurrency-language.html#5651" class="Datatype">Steps</a> <a id="5657" class="Symbol">:</a> <a id="5659" href="concurrency-language.html#957" class="Datatype">Command</a> <a id="5667" class="Symbol">→</a> <a id="5669" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="5673" class="Keyword">where</a>
  <a id="Steps.steps"></a><a id="5681" href="concurrency-language.html#5681" class="InductiveConstructor">steps</a> <a id="5687" class="Symbol">:</a> <a id="5689" class="Symbol">∀</a> <a id="5691" href="concurrency-language.html#5691" class="Bound">xs</a>
    <a id="5698" class="Symbol">→</a> <a id="5700" href="concurrency-language.html#1389" class="Generalizable">L</a> <a id="5702" href="concurrency-language.html#3782" class="Function Operator">—⇀</a> <a id="5705" href="concurrency-language.html#5691" class="Bound">xs</a>
      <a id="5714" class="Comment">----------</a>
    <a id="5729" class="Symbol">→</a> <a id="5731" href="concurrency-language.html#5651" class="Datatype">Steps</a> <a id="5737" href="concurrency-language.html#1389" class="Generalizable">L</a>

<a id="5740" class="Keyword">data</a> <a id="Finished"></a><a id="5745" href="concurrency-language.html#5745" class="Datatype">Finished</a> <a id="5754" class="Symbol">(</a><a id="5755" href="concurrency-language.html#5755" class="Bound">N</a> <a id="5757" class="Symbol">:</a> <a id="5759" href="concurrency-language.html#957" class="Datatype">Command</a><a id="5766" class="Symbol">)</a> <a id="5768" class="Symbol">:</a> <a id="5770" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="5774" class="Keyword">where</a>
   <a id="Finished.done"></a><a id="5783" href="concurrency-language.html#5783" class="InductiveConstructor">done</a> <a id="5788" class="Symbol">:</a>
       <a id="5797" href="concurrency-language.html#5651" class="Datatype">Steps</a> <a id="5803" href="concurrency-language.html#5755" class="Bound">N</a>
       <a id="5812" class="Comment">----------</a>
     <a id="5828" class="Symbol">→</a> <a id="5830" href="concurrency-language.html#5745" class="Datatype">Finished</a> <a id="5839" href="concurrency-language.html#5755" class="Bound">N</a>

   <a id="Finished.out-of-gas"></a><a id="5845" href="concurrency-language.html#5845" class="InductiveConstructor">out-of-gas</a> <a id="5856" class="Symbol">:</a>
       <a id="5865" class="Comment">----------</a>
       <a id="5883" href="concurrency-language.html#5745" class="Datatype">Finished</a> <a id="5892" href="concurrency-language.html#5755" class="Bound">N</a>
</pre>
<p>A command is finished when it is a value or when there is no more gas
available to calculate it.
In Agda, every computation must terminate. So it is impossible to have
an infinite loop. So when a command takes so much time
to finish, it runs out of gas and there is no result.</p>
<p>The evaluation finishes when there is proof of multi-step for the value
and it is already finished.</p>
<pre class="Agda"><a id="eval"></a><a id="6282" href="concurrency-language.html#6282" class="Function">eval</a> <a id="6287" class="Symbol">:</a>
  <a id="6291" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
  <a id="6295" class="Symbol">→</a> <a id="6297" href="Codata.Stream.html#900" class="Datatype">Stream</a> <a id="6304" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a> <a id="6309" class="Symbol">_</a>
  <a id="6313" class="Symbol">→</a> <a id="6315" class="Symbol">(</a><a id="6316" href="concurrency-language.html#6316" class="Bound">L</a> <a id="6318" class="Symbol">:</a> <a id="6320" href="concurrency-language.html#957" class="Datatype">Command</a><a id="6327" class="Symbol">)</a>
  <a id="6331" class="Symbol">→</a> <a id="6333" href="concurrency-language.html#5745" class="Datatype">Finished</a> <a id="6342" href="concurrency-language.html#6316" class="Bound">L</a>
<a id="6344" href="concurrency-language.html#6282" class="Function">eval</a> <a id="6349" class="Number">0</a> <a id="6351" href="concurrency-language.html#6351" class="Bound">sxs</a> <a id="6355" href="concurrency-language.html#6355" class="Bound">L</a> <a id="6357" class="Symbol">=</a> <a id="6359" href="concurrency-language.html#5845" class="InductiveConstructor">out-of-gas</a>
<a id="6370" href="concurrency-language.html#6282" class="Function">eval</a> <a id="6375" class="Symbol">(</a><a id="6376" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="6380" href="concurrency-language.html#6380" class="Bound">gas</a><a id="6383" class="Symbol">)</a> <a id="6385" href="concurrency-language.html#6385" class="Bound">sxs</a> <a id="6389" href="concurrency-language.html#6389" class="Bound">L</a> <a id="6391" class="Keyword">with</a> <a id="6396" href="concurrency-language.html#4669" class="Function">eval-step</a> <a id="6406" href="concurrency-language.html#6385" class="Bound">sxs</a> <a id="6410" href="concurrency-language.html#6389" class="Bound">L</a>
<a id="6412" class="Symbol">...</a> <a id="6416" class="Symbol">|</a> <a id="6418" href="concurrency-language.html#6418" class="Bound">sys</a> <a id="6422" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="6424" href="concurrency-language.html#4287" class="InductiveConstructor">singleStep</a> <a id="6435" href="concurrency-language.html#6435" class="Bound">n</a> <a id="6437" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a> <a id="6445" href="concurrency-language.html#6445" class="Bound">st</a> <a id="6448" class="Symbol">=</a> <a id="6450" href="concurrency-language.html#5783" class="InductiveConstructor">done</a> <a id="6455" class="Symbol">(</a><a id="6456" href="concurrency-language.html#5681" class="InductiveConstructor">steps</a> <a id="6462" href="Data.List.Base.html#5025" class="Function Operator">[</a> <a id="6464" href="concurrency-language.html#6435" class="Bound">n</a> <a id="6466" href="Data.List.Base.html#5025" class="Function Operator">]</a> <a id="6468" class="Symbol">(</a><a id="6469" class="Bound">L</a> <a id="6471" href="concurrency-language.html#3550" class="InductiveConstructor Operator">—→⟨⟩</a> <a id="6476" href="concurrency-language.html#6445" class="Bound">st</a><a id="6478" class="Symbol">))</a>
<a id="6481" class="Symbol">...</a> <a id="6485" class="Symbol">|</a> <a id="6487" href="concurrency-language.html#6487" class="Bound">sys</a> <a id="6491" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="6493" href="concurrency-language.html#4287" class="InductiveConstructor">singleStep</a> <a id="6504" href="concurrency-language.html#6504" class="Bound">n</a> <a id="6506" class="Symbol">(</a><a id="6507" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="6512" href="concurrency-language.html#6512" class="Bound">M</a><a id="6513" class="Symbol">)</a> <a id="6515" href="concurrency-language.html#6515" class="Bound">st</a> <a id="6518" class="Keyword">with</a> <a id="6523" href="concurrency-language.html#6282" class="Function">eval</a> <a id="6528" class="Bound">gas</a> <a id="6532" href="concurrency-language.html#6487" class="Bound">sys</a> <a id="6536" href="concurrency-language.html#6512" class="Bound">M</a>
<a id="6538" class="Symbol">...</a>   <a id="6544" class="Symbol">|</a> <a id="6546" href="concurrency-language.html#5845" class="InductiveConstructor">out-of-gas</a> <a id="6557" class="Symbol">=</a> <a id="6559" href="concurrency-language.html#5845" class="InductiveConstructor">out-of-gas</a>
<a id="6570" class="Symbol">...</a>   <a id="6576" class="Symbol">|</a> <a id="6578" href="concurrency-language.html#5783" class="InductiveConstructor">done</a> <a id="6583" class="Symbol">(</a><a id="6584" href="concurrency-language.html#5681" class="InductiveConstructor">steps</a> <a id="6590" href="concurrency-language.html#6590" class="Bound">xs</a> <a id="6593" href="concurrency-language.html#6593" class="Bound">st2</a><a id="6596" class="Symbol">)</a> <a id="6598" class="Symbol">=</a> <a id="6600" href="concurrency-language.html#5783" class="InductiveConstructor">done</a> <a id="6605" class="Symbol">(</a><a id="6606" href="concurrency-language.html#5681" class="InductiveConstructor">steps</a> <a id="6612" class="Symbol">(</a><a id="6613" class="Bound">n</a> <a id="6615" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="6617" href="concurrency-language.html#6590" class="Bound">xs</a><a id="6619" class="Symbol">)</a> <a id="6621" class="Symbol">(</a><a id="6622" class="Bound">L</a> <a id="6624" href="concurrency-language.html#3445" class="InductiveConstructor Operator">—→⟨</a> <a id="6628" class="Bound">st</a> <a id="6631" href="concurrency-language.html#3445" class="InductiveConstructor Operator">⟩</a> <a id="6633" href="concurrency-language.html#6593" class="Bound">st2</a><a id="6636" class="Symbol">))</a>
</pre>
<p>The evaluation takes gas and the command to evaluate.
In the end, it returns the value with proof that the command evaluates
this value.</p>
<p>Here, some examples of the evaluation:</p>
<pre class="Agda"><a id="rfalse"></a><a id="6826" href="concurrency-language.html#6826" class="Function">rfalse</a> <a id="6833" class="Symbol">=</a> <a id="6835" href="Codata.Stream.html#1083" class="Function">repeat</a> <a id="6842" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a>
<a id="rtrue"></a><a id="6848" href="concurrency-language.html#6848" class="Function">rtrue</a> <a id="6854" class="Symbol">=</a> <a id="6856" href="Codata.Stream.html#1083" class="Function">repeat</a> <a id="6863" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a>
<a id="evalf"></a><a id="6868" href="concurrency-language.html#6868" class="Function">evalf</a> <a id="6874" class="Symbol">=</a> <a id="6876" href="concurrency-language.html#6282" class="Function">eval</a> <a id="6881" class="Number">100</a> <a id="6885" href="concurrency-language.html#6826" class="Function">rfalse</a>
<a id="evalt"></a><a id="6892" href="concurrency-language.html#6892" class="Function">evalt</a> <a id="6898" class="Symbol">=</a> <a id="6900" href="concurrency-language.html#6282" class="Function">eval</a> <a id="6905" class="Number">100</a> <a id="6909" href="concurrency-language.html#6848" class="Function">rtrue</a>

<a id="6916" href="concurrency-language.html#6916" class="Function">_</a> <a id="6918" class="Symbol">:</a> <a id="6920" href="concurrency-language.html#6868" class="Function">evalf</a> <a id="6926" href="concurrency-language.html#2881" class="Function">||prog</a> <a id="6933" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="6935" href="concurrency-language.html#5783" class="InductiveConstructor">done</a>
  <a id="6942" class="Symbol">(</a><a id="6943" href="concurrency-language.html#5681" class="InductiveConstructor">steps</a> <a id="6949" class="Symbol">(</a><a id="6950" class="Number">0</a> <a id="6952" class="InductiveConstructor Operator">∷</a> <a id="6954" href="Data.List.Base.html#5025" class="Function Operator">[</a> <a id="6956" class="Number">1</a> <a id="6958" href="Data.List.Base.html#5025" class="Function Operator">]</a><a id="6959" class="Symbol">)</a>
  <a id="6963" class="Symbol">(</a><a id="6964" href="concurrency-language.html#979" class="InductiveConstructor">print</a> <a id="6970" class="Number">0</a> <a id="6972" href="concurrency-language.html#1001" class="InductiveConstructor Operator">||</a> <a id="6975" href="concurrency-language.html#979" class="InductiveConstructor">print</a> <a id="6981" class="Number">1</a> <a id="6983" href="concurrency-language.html#3445" class="InductiveConstructor Operator">—→⟨</a> <a id="6987" href="concurrency-language.html#1863" class="InductiveConstructor">ξ||∅ₗ</a> <a id="6993" href="concurrency-language.html#1474" class="InductiveConstructor">ξℕ</a> <a id="6996" href="concurrency-language.html#3445" class="InductiveConstructor Operator">⟩</a>
  <a id="7000" class="Symbol">(</a><a id="7001" href="concurrency-language.html#979" class="InductiveConstructor">print</a> <a id="7007" class="Number">1</a> <a id="7009" href="concurrency-language.html#3550" class="InductiveConstructor Operator">—→⟨⟩</a> <a id="7014" href="concurrency-language.html#1474" class="InductiveConstructor">ξℕ</a><a id="7016" class="Symbol">)))</a>
<a id="7020" class="Symbol">_</a> <a id="7022" class="Symbol">=</a> <a id="7024" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>

<a id="7030" href="concurrency-language.html#7030" class="Function">_</a> <a id="7032" class="Symbol">:</a> <a id="7034" href="concurrency-language.html#6892" class="Function">evalt</a> <a id="7040" href="concurrency-language.html#2881" class="Function">||prog</a> <a id="7047" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="7049" href="concurrency-language.html#5783" class="InductiveConstructor">done</a>
  <a id="7056" class="Symbol">(</a><a id="7057" href="concurrency-language.html#5681" class="InductiveConstructor">steps</a> <a id="7063" class="Symbol">(</a><a id="7064" class="Number">1</a> <a id="7066" class="InductiveConstructor Operator">∷</a> <a id="7068" href="Data.List.Base.html#5025" class="Function Operator">[</a> <a id="7070" class="Number">0</a> <a id="7072" href="Data.List.Base.html#5025" class="Function Operator">]</a><a id="7073" class="Symbol">)</a>
  <a id="7077" class="Symbol">(</a><a id="7078" href="concurrency-language.html#979" class="InductiveConstructor">print</a> <a id="7084" class="Number">0</a> <a id="7086" href="concurrency-language.html#1001" class="InductiveConstructor Operator">||</a> <a id="7089" href="concurrency-language.html#979" class="InductiveConstructor">print</a> <a id="7095" class="Number">1</a> <a id="7097" href="concurrency-language.html#3445" class="InductiveConstructor Operator">—→⟨</a> <a id="7101" href="concurrency-language.html#2236" class="InductiveConstructor">ξ||∅ᵣ</a> <a id="7107" href="concurrency-language.html#1474" class="InductiveConstructor">ξℕ</a> <a id="7110" href="concurrency-language.html#3445" class="InductiveConstructor Operator">⟩</a>
  <a id="7114" class="Symbol">(</a><a id="7115" href="concurrency-language.html#979" class="InductiveConstructor">print</a> <a id="7121" class="Number">0</a> <a id="7123" href="concurrency-language.html#3550" class="InductiveConstructor Operator">—→⟨⟩</a> <a id="7128" href="concurrency-language.html#1474" class="InductiveConstructor">ξℕ</a><a id="7130" class="Symbol">)))</a>
<a id="7134" class="Symbol">_</a> <a id="7136" class="Symbol">=</a> <a id="7138" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>

<a id="7144" href="concurrency-language.html#7144" class="Function">_</a> <a id="7146" class="Symbol">:</a> <a id="7148" href="concurrency-language.html#6868" class="Function">evalf</a> <a id="7154" class="Symbol">(</a><a id="7155" href="concurrency-language.html#979" class="InductiveConstructor">print</a> <a id="7161" class="Number">0</a> <a id="7163" href="concurrency-language.html#1038" class="InductiveConstructor Operator">,,</a> <a id="7166" href="concurrency-language.html#979" class="InductiveConstructor">print</a> <a id="7172" class="Number">1</a><a id="7173" class="Symbol">)</a> <a id="7175" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="7177" href="concurrency-language.html#5783" class="InductiveConstructor">done</a>
  <a id="7184" class="Symbol">(</a><a id="7185" href="concurrency-language.html#5681" class="InductiveConstructor">steps</a> <a id="7191" class="Symbol">(</a><a id="7192" class="Number">0</a> <a id="7194" class="InductiveConstructor Operator">∷</a> <a id="7196" href="Data.List.Base.html#5025" class="Function Operator">[</a> <a id="7198" class="Number">1</a> <a id="7200" href="Data.List.Base.html#5025" class="Function Operator">]</a><a id="7201" class="Symbol">)</a>
  <a id="7205" class="Symbol">(</a><a id="7206" href="concurrency-language.html#979" class="InductiveConstructor">print</a> <a id="7212" class="Number">0</a> <a id="7214" href="concurrency-language.html#1038" class="InductiveConstructor Operator">,,</a> <a id="7217" href="concurrency-language.html#979" class="InductiveConstructor">print</a> <a id="7223" class="Number">1</a> <a id="7225" href="concurrency-language.html#3445" class="InductiveConstructor Operator">—→⟨</a> <a id="7229" href="concurrency-language.html#2652" class="InductiveConstructor">ξ,,∅</a> <a id="7234" href="concurrency-language.html#1474" class="InductiveConstructor">ξℕ</a> <a id="7237" href="concurrency-language.html#3445" class="InductiveConstructor Operator">⟩</a>
  <a id="7241" class="Symbol">(</a><a id="7242" href="concurrency-language.html#979" class="InductiveConstructor">print</a> <a id="7248" class="Number">1</a> <a id="7250" href="concurrency-language.html#3550" class="InductiveConstructor Operator">—→⟨⟩</a> <a id="7255" href="concurrency-language.html#1474" class="InductiveConstructor">ξℕ</a><a id="7257" class="Symbol">)))</a>
<a id="7261" class="Symbol">_</a> <a id="7263" class="Symbol">=</a> <a id="7265" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
</pre>
    </section>
</article>

        </main>

        <footer>
            Site proudly generated by
            <a style="color:yellow;" href="http://jaspervdj.be/hakyll">Hakyll</a> with
            <a style="color:yellow;" href="https://github.com/guilhermehas/guilhermehas.github.io">source code</a>
        </footer>
    </body>
</html>
